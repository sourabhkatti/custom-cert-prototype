<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chainguard Custom Packages - Certificate Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chainguard-dark': '#14003D',
                        'chainguard-darker': '#110033',
                        'chainguard-teal': '#7AF0FE',
                        'chainguard-text-secondary': '#c5c5c5',
                    },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #110033;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .lucide { width: 1rem; height: 1rem; }
        .lucide-lg { width: 1.25rem; height: 1.25rem; }
        .text-chainguard-text-secondary { color: #c5c5c5; }
        .border-chainguard-teal { border-color: #7AF0FE; }
        .bg-chainguard-teal { background-color: #7AF0FE; }
        .text-chainguard-teal { color: #7AF0FE; }
        .bg-chainguard-dark { background-color: #14003D; }
        .bg-chainguard-darker { background-color: #110033; }

        /* Enhanced hover states */
        .certificate-row:hover .text-chainguard-teal {
            text-decoration: underline;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Smooth transitions */
        .bundle-arrow {
            transition: transform 0.2s ease;
        }

        /* Enhanced drag states */
        .drag-active {
            border-color: #7AF0FE !important;
            background-color: rgba(122, 240, 254, 0.05) !important;
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="flex min-h-screen">
        <!-- Navigation -->
        <nav class="w-72 h-screen p-6 border-r border-gray-700" style="background-color: #14003D;">
            <div class="mb-6">
                <div class="flex items-center gap-2 mb-6">
                    <div class="w-6 h-6 bg-chainguard-teal rounded"></div>
                    <span class="text-white font-bold text-lg">chainguard</span>
                </div>
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-7 h-7 rounded-full bg-gray-600 flex items-center justify-center">
                        <i data-lucide="user" class="lucide text-white"></i>
                    </div>
                    <div class="flex items-center gap-2 bg-gray-700/30 rounded-full px-3 py-1">
                        <span class="text-chainguard-teal text-sm font-medium">cloud-services.com</span>
                        <i data-lucide="chevron-down" class="lucide text-chainguard-teal" style="width: 12px; height: 12px;"></i>
                    </div>
                </div>
            </div>

            <ul class="space-y-1">
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="layout-grid" class="lucide-lg"></i>Overview</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="trending-up" class="lucide-lg"></i>Reports</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="package" class="lucide-lg"></i>Images</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium bg-white/16 text-white">
                    <i data-lucide="settings" class="lucide-lg"></i>Custom Packages</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="package-2" class="lucide-lg"></i>Helm charts</a></li>
            </ul>

            <div class="absolute bottom-6 left-6 right-6 border-t border-gray-700 pt-4">
                <ul class="space-y-1">
                    <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                        <i data-lucide="settings" class="lucide-lg"></i>Settings</a></li>
                    <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                        <i data-lucide="info" class="lucide-lg"></i>Docs & support</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-white mb-2" style="font-size: 24px; letter-spacing: -0.72px;">Custom Packages</h1>
                <p class="text-white text-base">
                    Create and manage certificate packages for your container images.
                    <span class="text-chainguard-teal cursor-pointer hover:underline">Learn more</span>
                </p>
            </div>

            <div class="flex items-center justify-between mb-6">
                <div class="relative w-96">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="lucide text-gray-400"></i>
                    </div>
                    <input type="text" placeholder="Filter..." class="w-full pl-10 pr-4 py-2 bg-chainguard-dark border border-gray-600 rounded text-white placeholder-gray-400 focus:border-chainguard-teal focus:outline-none text-sm">
                </div>
                <button id="createPackageBtn" class="border border-chainguard-teal text-white px-6 py-2 rounded-full text-sm font-semibold hover:bg-chainguard-teal hover:text-black transition-colors">
                    Create New Custom Package
                </button>
            </div>

            <!-- Existing Packages Table -->
            <div class="bg-chainguard-darker/50 rounded-lg border border-gray-700 overflow-hidden">
                <div class="border-b border-gray-700 px-2 py-3">
                    <div class="grid grid-cols-5 gap-4 text-sm font-semibold text-white px-2">
                        <div class="text-left" style="width: 238px;">Package name</div>
                        <div class="text-left" style="width: 209px;">Common name</div>
                        <div class="text-left" style="width: 159px;">Issuer</div>
                        <div class="text-left" style="width: 132px;">Expires on</div>
                        <div class="text-right" style="width: 98px;">Updated</div>
                    </div>
                </div>

                <div class="divide-y divide-gray-700" id="packagesTable">
                    <!-- Individual AWS Certificates -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="aws-ec2-internal" onclick="viewCertificate('aws-ec2-internal')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">acme-corp-aws-private-ca</div>
                                <div class="text-white" style="width: 209px;">*.internal.acme-corp.com</div>
                                <div class="text-white" style="width: 159px;">ACME Corp AWS Private CA Root</div>
                                <div class="text-white" style="width: 132px;">Dec 15, 2026</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="aws-elb-cert" onclick="viewCertificate('aws-elb-cert')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">defense-contractor-aws-ca</div>
                                <div class="text-white" style="width: 209px;">*.services.lockheedmartin-internal.com</div>
                                <div class="text-white" style="width: 159px;">Lockheed Martin AWS Private CA</div>
                                <div class="text-white" style="width: 132px;">Aug 22, 2027</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 day ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="aws-cloudfront" onclick="viewCertificate('aws-cloudfront')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">fintech-app-tls-cert</div>
                                <div class="text-white" style="width: 209px;">*.api.fintech-internal.com</div>
                                <div class="text-white" style="width: 159px;">FinTech Corp AWS Private CA</div>
                                <div class="text-white" style="width: 132px;">Mar 10, 2028</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">3 days ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Individual GCP Certificates -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="gcp-compute" onclick="viewCertificate('gcp-compute')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">enterprise-gcp-workload-ca</div>
                                <div class="text-white" style="width: 209px;">workload-identity.gke.internal.techcorp.com</div>
                                <div class="text-white" style="width: 159px;">TechCorp Google Cloud CA Service Root</div>
                                <div class="text-white" style="width: 132px;">Nov 18, 2027</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">5 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="gcp-storage" onclick="viewCertificate('gcp-storage')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">enterprise-service-mesh-ca</div>
                                <div class="text-white" style="width: 209px;">istio.mesh.internal.techcorp.com</div>
                                <div class="text-white" style="width: 159px;">TechCorp Service Mesh CA (GCP)</div>
                                <div class="text-white" style="width: 132px;">Sep 5, 2027</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">12 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Individual Azure Certificates -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="azure-webapp" onclick="viewCertificate('azure-webapp')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">healthcare-azure-ca</div>
                                <div class="text-white" style="width: 209px;">*.internal.healthsys.com</div>
                                <div class="text-white" style="width: 159px;">HealthSys Azure Private CA</div>
                                <div class="text-white" style="width: 132px;">Jun 12, 2026</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">6 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="azure-keyvault" onclick="viewCertificate('azure-keyvault')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">financial-vault-ca</div>
                                <div class="text-white" style="width: 209px;">vault.secure.bigbank-internal.com</div>
                                <div class="text-white" style="width: 159px;">BigBank Azure Key Vault CA</div>
                                <div class="text-white" style="width: 132px;">Apr 8, 2028</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">8 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- DoD Certificate -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="dod-pki" onclick="viewCertificate('dod-pki')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">boeing-dod-eca-cert</div>
                                <div class="text-white" style="width: 209px;">contractor-auth.boeing.com</div>
                                <div class="text-white" style="width: 159px;">DoD External CA 4 (ECA)</div>
                                <div class="text-white" style="width: 132px;">Jan 24, 2053</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 day ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Uploaded Certificate -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="custom" data-cert-id="internal-ca" onclick="viewCertificate('internal-ca')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">brasil-gov-icp-brasil</div>
                                <div class="text-white" style="width: 209px;">assinatura.gov.br</div>
                                <div class="text-white" style="width: 159px;">AC Raiz da ICP-Brasil v13</div>
                                <div class="text-white" style="width: 132px;">Oct 15, 2025</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">3 days ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- AWS Expandable Bundle -->
                    <div class="expandable-bundle">
                        <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" onclick="toggleBundle(this)">
                            <div class="px-2 py-2">
                                <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                    <div class="flex items-center gap-2" style="width: 238px;">
                                        <i data-lucide="chevron-right" class="lucide text-white transition-transform bundle-arrow" style="width: 12px; height: 12px;"></i>
                                        <i data-lucide="folder" class="lucide text-chainguard-teal" style="width: 14px; height: 14px;"></i>
                                        <span class="text-chainguard-teal font-medium cursor-pointer" onclick="event.stopPropagation(); viewCertificate('aws-services-bundle');">acme-corp-aws-services (3)</span>
                                    </div>
                                    <div class="text-white" style="width: 209px;">Multi-service bundle</div>
                                    <div class="text-white" style="width: 159px;">ACME Corp AWS Private CA</div>
                                    <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                    <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                </div>
                            </div>
                        </div>
                        <div class="bundle-content hidden pl-8 bg-gray-800/20">
                            <div class="divide-y divide-gray-700/50">
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('aws-bundle-cert-1')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.microservices.acme-corp.com</div>
                                        <div class="text-white" style="width: 159px;">ACME Corp AWS Private CA</div>
                                        <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                    </div>
                                </div>
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('aws-bundle-cert-2')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.db.acme-corp.com</div>
                                        <div class="text-white" style="width: 159px;">ACME Corp AWS Private CA</div>
                                        <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                    </div>
                                </div>
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('aws-bundle-cert-3')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.serverless.acme-corp.com</div>
                                        <div class="text-white" style="width: 159px;">ACME Corp AWS Private CA</div>
                                        <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GCP Expandable Bundle -->
                    <div class="expandable-bundle">
                        <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" onclick="toggleBundle(this)">
                            <div class="px-2 py-2">
                                <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                    <div class="flex items-center gap-2" style="width: 238px;">
                                        <i data-lucide="chevron-right" class="lucide text-white transition-transform bundle-arrow" style="width: 12px; height: 12px;"></i>
                                        <i data-lucide="folder" class="lucide text-chainguard-teal" style="width: 14px; height: 14px;"></i>
                                        <span class="text-chainguard-teal font-medium cursor-pointer" onclick="event.stopPropagation(); viewCertificate('gcp-platform-bundle');">techcorp-gcp-workload-bundle (2)</span>
                                    </div>
                                    <div class="text-white" style="width: 209px;">Workload identity bundle</div>
                                    <div class="text-white" style="width: 159px;">TechCorp Google Cloud CA</div>
                                    <div class="text-white" style="width: 132px;">Jan 20, 2029</div>
                                    <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 weeks ago</div>
                                </div>
                            </div>
                        </div>
                        <div class="bundle-content hidden pl-8 bg-gray-800/20">
                            <div class="divide-y divide-gray-700/50">
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('gcp-bundle-cert-1')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">api.k8s.internal.techcorp.com</div>
                                        <div class="text-white" style="width: 159px;">TechCorp Google Cloud CA Service</div>
                                        <div class="text-white" style="width: 132px;">Jan 20, 2029</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 weeks ago</div>
                                    </div>
                                </div>
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('gcp-bundle-cert-2')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">mesh.istio.internal.techcorp.com</div>
                                        <div class="text-white" style="width: 159px;">TechCorp Service Mesh CA (GCP)</div>
                                        <div class="text-white" style="width: 132px;">Jan 20, 2029</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 weeks ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Side Panel -->
    <div id="panelOverlay" class="fixed inset-0 z-50 overflow-hidden hidden">
        <div class="absolute inset-0 bg-black/50" onclick="closePanel()"></div>
        <div class="absolute right-0 top-0 h-full w-[600px] shadow-xl" style="background-color: #14003D; border-left: 1px solid rgb(75 85 99);">
            <div class="flex flex-col h-full">
                <div class="flex items-center justify-between p-6 border-b border-gray-700">
                    <div>
                        <h2 class="text-xl font-bold text-white">Create Custom Package</h2>
                        <p class="text-sm text-gray-300 mt-1">Add certificate bundles to create a new custom package</p>
                    </div>
                    <button onclick="closePanel()" class="p-2 rounded-md hover:bg-white/10 text-gray-300 hover:text-white transition-colors">
                        <i data-lucide="x" class="lucide"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6">
                    <!-- Step 1: Selection -->
                    <div id="step-selection">
                        <h3 class="text-base font-semibold text-white mb-3">Choose how to create your package</h3>
                        <div class="space-y-4">
                            <button onclick="showUpload()" class="w-full p-6 text-left rounded-lg border border-gray-600 hover:border-chainguard-teal hover:bg-chainguard-teal/5 transition-all group" style="background-color: rgba(17, 0, 51, 0.5);">
                                <h4 class="text-sm font-medium text-white mb-1 group-hover:text-chainguard-teal">Upload Certificate Bundle</h4>
                                <p class="text-xs text-gray-300">Create a custom package by uploading your own certificate files in PEM or PKCS#7 format</p>
                            </button>
                            <button onclick="showSuggestions()" class="w-full p-6 text-left rounded-lg border border-gray-600 hover:border-chainguard-teal hover:bg-chainguard-teal/5 transition-all group" style="background-color: rgba(17, 0, 51, 0.5);">
                                <h4 class="text-sm font-medium text-white mb-1 group-hover:text-chainguard-teal">Browse Chainguard Suggestions</h4>
                                <p class="text-xs text-gray-300">Create packages from popular, auto-updating certificate bundles managed by Chainguard</p>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Suggestions -->
                    <div id="step-suggestions" class="hidden">
                        <h3 class="text-base font-semibold text-white mb-2">Chainguard Suggestions</h3>
                        <p class="text-xs text-gray-300 mb-4">Popular certificate bundles maintained by Chainguard.</p>

                        <div class="grid gap-3" id="certificateOptions">
                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="dod-eca" onclick="selectBundle('dod-eca', this)">
                                <h4 class="font-medium text-white text-xs mb-1">DoD PKCS#7 for ECA PKI Only</h4>
                                <p class="text-xs text-gray-400 mb-1">v5.12 • 12 certificates</p>
                                <p class="text-xs text-gray-300">US Department of Defense Enterprise Certificate Authority</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="dod-wcf" onclick="selectBundle('dod-wcf', this)">
                                <h4 class="font-medium text-white text-xs mb-1">DoD PKI CA Certificate Bundles: PKCS#7 for WCF B&I PKI</h4>
                                <p class="text-xs text-gray-400 mb-1">v5.17 • 8 certificates</p>
                                <p class="text-xs text-gray-300">DoD Web Communications Framework</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="icp-brazil" onclick="selectBundle('icp-brazil', this)">
                                <h4 class="font-medium text-white text-xs mb-1">PKI ICP Brazil</h4>
                                <p class="text-xs text-gray-400 mb-1">v2024.1 • 24 certificates</p>
                                <p class="text-xs text-gray-300">Brazilian Public Key Infrastructure</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="aws-pca" onclick="selectBundle('aws-pca', this)">
                                <h4 class="font-medium text-white text-xs mb-1">AWS Private CA Bundle</h4>
                                <p class="text-xs text-gray-400 mb-1">vLatest • 6 certificates</p>
                                <p class="text-xs text-gray-300">Amazon Web Services Private Certificate Authority</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="gcp-ca" onclick="selectBundle('gcp-ca', this)">
                                <h4 class="font-medium text-white text-xs mb-1">Google Cloud Certificate Authority Service</h4>
                                <p class="text-xs text-gray-400 mb-1">vLatest • 4 certificates</p>
                                <p class="text-xs text-gray-300">Google Cloud Platform managed certificate authorities</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.5: Upload Certificate -->
                    <div id="step-upload" class="hidden">
                        <h3 class="text-base font-semibold text-white mb-2">Upload Certificate</h3>
                        <p class="text-xs text-gray-300 mb-4">Upload your own certificate bundle in PEM or PKCS#7 format</p>

                        <div class="space-y-6">
                            <!-- Drag & Drop Area -->
                            <div id="upload-area" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-gray-500 transition-colors" style="background-color: rgba(17, 0, 51, 0.3);">
                                <input type="file" id="file-input" class="hidden" accept=".pem,.crt,.cer,.p7b,.p7c">
                                <i data-lucide="upload" class="lucide text-gray-400 mx-auto mb-4" style="width: 2rem; height: 2rem;"></i>
                                <h4 class="text-white font-medium text-sm mb-1">Drop certificate file here or click to browse</h4>
                                <p class="text-xs text-gray-300">Supports PEM, CRT, CER, PKCS#7 formats</p>
                            </div>

                            <!-- Certificate Preview -->
                            <div id="certificate-preview" class="hidden">
                                <h4 class="text-xs font-medium text-white mb-2">Certificate Content</h4>
                                <div class="bg-chainguard-darker border border-gray-600 rounded overflow-hidden">
                                    <div class="relative">
                                        <div id="line-numbers" class="absolute left-1 top-1 text-xs text-gray-500 font-mono leading-tight text-right w-6 select-none z-10"></div>
                                        <div id="certificate-content" class="pl-8 pr-2 py-1 text-xs font-mono text-gray-300 leading-tight max-h-40 overflow-y-auto"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Package Name -->
                            <div class="space-y-1">
                                <label class="block text-xs font-medium text-white">Package name</label>
                                <input id="upload-package-name" type="text" class="w-full px-2 py-1.5 bg-chainguard-dark border border-gray-600 rounded text-white placeholder-gray-400 focus:border-chainguard-teal focus:outline-none text-xs">
                                <p class="text-xs text-gray-400">Package name can only contain ASCII letters, digits, and the characters ., -, and _.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Package Configuration -->
                    <div id="step-details" class="hidden">
                        <h3 class="text-base font-semibold text-white mb-2">Configure Package</h3>
                        <p class="text-xs text-gray-300 mb-4">Name your package and review the selected certificate bundle</p>

                        <div id="selected-bundle-info" class="bg-chainguard-darker/50 border border-gray-600 rounded-lg p-4 mb-6">
                            <!-- Bundle info will be populated here -->
                        </div>

                        <div class="space-y-1">
                            <label class="block text-xs font-medium text-white">Package name</label>
                            <input id="packageNameInput" type="text" class="w-full px-2 py-1.5 bg-chainguard-dark border border-gray-600 rounded text-white placeholder-gray-400 focus:border-chainguard-teal focus:outline-none text-xs">
                            <p class="text-xs text-gray-400">Package name can only contain ASCII letters, digits, and the characters ., -, and _.</p>
                        </div>
                    </div>
                </div>

                <div class="p-6 border-t border-gray-700">
                    <div class="flex justify-between">
                        <div class="flex gap-3">
                            <button id="backBtn" onclick="goBack()" class="hidden flex items-center gap-2 px-4 py-2 text-gray-300 hover:text-white transition-colors">
                                <i data-lucide="arrow-left" class="lucide"></i>Back
                            </button>
                        </div>
                        <div class="flex gap-3">
                            <button id="nextBtn" onclick="proceedNext()" class="hidden bg-chainguard-teal hover:bg-opacity-90 text-black px-6 py-2 rounded-md font-medium flex items-center gap-2 transition-colors">
                                Next <i data-lucide="arrow-right" class="lucide"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="fixed top-4 right-4 z-[110] bg-green-500/20 border border-green-500/40 text-green-400 px-4 py-3 rounded-lg hidden">
        Custom package created successfully!
    </div>

    <!-- Delete Confirmation Dialog -->
    <div id="deleteDialog" class="fixed inset-0 z-[100] overflow-hidden hidden">
        <div class="absolute inset-0 bg-black/60"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-chainguard-dark border border-gray-700 rounded-lg shadow-2xl w-[500px] max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center">
                        <i data-lucide="alert-triangle" class="h-5 w-5 text-red-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-white">Delete Certificate Package</h3>
                </div>

                <p class="text-gray-300 mb-4">
                    Are you sure you want to delete <span id="delete-cert-name" class="text-chainguard-teal font-medium"></span>? This action cannot be undone.
                </p>

                <div id="affected-images-section" class="mb-6">
                    <div class="bg-orange-500/5 border border-orange-500/20 rounded-lg p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <i data-lucide="package" class="h-4 w-4 text-orange-400"></i>
                            <h4 class="text-sm font-medium text-orange-400">Affected Container Images</h4>
                        </div>
                        <p class="text-xs text-gray-400 mb-3">The following images use this certificate package and will be affected:</p>
                        <div id="affected-images-list" class="space-y-2">
                            <!-- Images will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="flex gap-3 justify-end">
                    <button onclick="cancelDelete()" class="px-4 py-2 text-gray-300 hover:text-white transition-colors rounded-md border border-gray-600 hover:border-gray-500">
                        Cancel
                    </button>
                    <button onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium flex items-center gap-2 transition-colors">
                        <i data-lucide="trash-2" class="h-4 w-4"></i>
                        Delete Package
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let selectedBundle = null;
        let currentStep = 'selection';
        let uploadedFile = null;
        let uploadedFileContent = null;
        let currentViewingCert = null;
        let certificateToDelete = null;
        let isEditMode = false;

        // Certificate database - Realistic enterprise PKI scenarios
        const certificateData = {
            'aws-ec2-internal': {
                type: 'individual',
                packageName: 'acme-corp-aws-private-ca',
                commonName: '*.internal.acme-corp.com',
                issuer: 'ACME Corp AWS Private CA Root',
                expiryDate: 'Dec 15, 2026',
                lastUpdated: '2 hours ago',
                source: 'AWS Private CA',
                sourceUrl: 'https://docs.aws.amazon.com/privateca/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIFgzCCA2ugAwIBAgIUQwEBAQEBFgIBADAKBggqhkjOPQQDAjCBhTELMAkGA1UE
BhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0bGUxEjAQ
BgNVBAoMCUFDTUUgQ29ycDEXMBUGA1UECwwOSW50ZXJuYWwgU2VydmMxIjAgBgNV
BAMMGUFDTUUgQ29ycCBBV1MgUHJpdmF0ZSBDQTAeFw0yNDEyMTUwMDAwMDBaFw0y
NjEyMTUyMzU5NTlaMIGFMQswCQYDVQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3Rv
bjEQMA4GA1UEBwwHU2VhdHRsZTESMBAGA1UECgwJQUNNRSBDb3JwMRcwFQYDVQQL
DA5JbnRlcm5hbCBTZXJ2YzEiMCAGA1UEAwwZQUNNRSBDb3JwIEFXUyBQcml2YXRl
IENBMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEk2LkMaUT9vC6r3dFZ5V8Nk4Y
R8YPRQ9X2wV7KxgU4J8nH1R6eF4Qp3mT9zL6wE5N8zXvY2rD4kF7gH5I3jW2TqOB
8jCB7zAdBgNVHQ4EFgQU0K+1x7zR3vG9Q8P2wV5H4kL7yX0wDAYDVR0TAQH/BAIw
ADALBgNVHQ8EBAMCAQYwIAYDVR0lAQH/BBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMC
MIGoBgNVHR8EgaAwgZ0wgZqggZeggZSGgZFsZGFwOi8vbGRhcC5hY21lLWNvcnAu
Y29tL0NOPUFDTUUlMjBDb3JwJTIwQVdTJTIwUHJpdmF0ZSUyMENBLE89SW50ZXJu
YWwlMjBTZXJ2aWNlLEM9U2VhdHRsZSxTVD1XYXNoaW5ndG9uLEM9VVNVkwHRE5w
QIDAQABoxAwDjAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3DQEBCwUAA4ICAQBwR8fK
JH2vQz9x3wE5N8P7y2kF5oH4J8nR6eL4Qp3mT9zL6wE5N8zXvY2rD4kF7gH5I3jW
2TqOB8jCB7z
-----END CERTIFICATE-----`
            },
            'aws-elb-cert': {
                type: 'individual',
                packageName: 'defense-contractor-aws-ca',
                commonName: '*.services.lockheedmartin-internal.com',
                issuer: 'Lockheed Martin AWS Private CA',
                expiryDate: 'Aug 22, 2027',
                lastUpdated: '1 day ago',
                source: 'AWS Private CA',
                sourceUrl: 'https://docs.aws.amazon.com/privateca/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAK8wE3z7+GovMA0GCSqGSIb3DQEBCwUAMGUxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMRAwDgYDVQQHDAeGVhdHRsZTEWMBQG
A1UECgwNQW1hem9uIEdvdkNsb3VkMRcwFQYDVQQLDA5Mb2FkIEJhbGFuY2VyMRQwE
gYDVQQDDAtHb3ZDbG91ZCBDQTAQBQ0yNDA4MjIyMTQ1MDBaFwoyNzA4MjIyMTQ1MDB
aMGUxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDAphc2hpbmd0b24xEDAOBgNVBAcMB1Nl
YXR0bGUxFjAUBgNVBAoMDUFtYXpvbiBHb3ZDbG91ZDEXMBUGA1UECwwOTG9hZCBCYW
xhbmNlcjEUMBIGA1UEAwwLR292Q2xvdWQgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4I
BDwAwggEKAoIBAQC9sK1u5w51OkG8fw3ReHS/itcp9AEFC4ETwumtfwlS+tmxBU3u
lJPATIHC/TCOg6TksvijvwT8RJdmgOUQj1u/+PEo6C7tgBgM5t0RR3kYCFI2j1tR
ObJ4XVFELKBu8qL5oK2nV4nD3xI1234567890abcdefghijklmnopqrstuvwxyzABC
DEF1234567890
-----END CERTIFICATE-----`
            },
            'aws-cloudfront': {
                type: 'individual',
                packageName: 'fintech-app-tls-cert',
                commonName: '*.api.fintech-internal.com',
                issuer: 'FinTech Corp AWS Private CA',
                expiryDate: 'Mar 10, 2028',
                lastUpdated: '3 days ago',
                source: 'AWS Private CA',
                sourceUrl: 'https://docs.aws.amazon.com/privateca/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+CloudMA0GCSqGSIb3DQEBCwUAMFUxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMRAwDgYDVQQHDAeGVhdHRsZTEWMBQG
A1UECgwNQW1hem9uIEdvdkNsb3VkMRwwGgYDVQQLDBNDbG91ZEZyb250IERpc3Ry
aWJamW0xFDAOBgNVBAMMB0NsZCBDQTAeFw0yNDAzMTAyMTQ1MDBaFw0yODAzMTAyM
TQ1MDBaMFUxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDAphc2hpbmd0b24xEDAOBgNVBA
cMB1NlYXR0bGUxFjAUBgNVBAoMDUFtYXpvbiBHb3ZDbG91ZDEXMBUGA1UECwwOTG9
hZCBCYWxhbmNlcjEUMBIGA1UEAwwLR292Q2xvdWQgQ0EwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQCg1B2j4m87IkL0FedRAMP/OJKLNFtQkN+wH7Kp3kQC
XpABCDEF1234567890abcdefghijklmnop
-----END CERTIFICATE-----`
            },
            'gcp-compute': {
                type: 'individual',
                packageName: 'enterprise-gcp-workload-ca',
                commonName: 'workload-identity.gke.internal.techcorp.com',
                issuer: 'TechCorp Google Cloud CA Service Root',
                expiryDate: 'Nov 18, 2027',
                lastUpdated: '5 hours ago',
                source: 'Google Cloud Certificate Authority Service',
                sourceUrl: 'https://cloud.google.com/certificate-authority-service/docs',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+GcpMA0GCSqGSIb3DQEBCwUAMFoxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYWxpZm9ybmlhMRQwEgYDVQQHDAtNb3VudGFpbiB
WaWV3MQ8wDQYDVQQKDAZHb29nbGUxGTAXBgNVBAsMEEZlZFJBTVAgQ29tcHV0ZTEK
MAkGA1UEAwwCQ0EwHhcNMjQxMTE4MjE0NTAwWhcNMjcxMTE4MjE0NTAwWjBaMQsw
CQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEUMBIGA1UEBwwLTW91bnRh
aW4gVmlldzEPMA0GA1UECgwGR29vZ2xlMRkwFwYDVQQLDBBGZWRSQU1QIENvbXB1
dGUxCjAIBgNVBAMMCENBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
tLK5oK2nV4nD3xI9FEDRAMP123GH5E8fw3ReHS/itcp9AEFC4ETwumtfwlS+tmxB
U3ulJPATIHC/TCOg6TksvijvwT8RJdmgOUQj1u/+PEo6C7tgBgM5t0RR3kYCFI2j
1tRObJ4XVFELK567890abcdefghijklmn
-----END CERTIFICATE-----`
            },
            'gcp-storage': {
                type: 'individual',
                packageName: 'enterprise-service-mesh-ca',
                commonName: 'istio.mesh.internal.techcorp.com',
                issuer: 'TechCorp Service Mesh CA (GCP)',
                expiryDate: 'Sep 5, 2027',
                lastUpdated: '12 hours ago',
                source: 'Google Cloud Certificate Authority Service',
                sourceUrl: 'https://cloud.google.com/certificate-authority-service/docs',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAK8wE3z7+FedMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYWxpZm9ybmlhMRQwEgYDVQQHDAtNb3VudGFpbiB
WaWV3MQ8wDQYDVQQKDAZHb29nbGUxHDAaBgNVBAsME0ZlZFJBTVAgU3RvcmFnZTE
KMAkGA1UEAwwCQ0EwHhcNMjQwOTA1MjE0NTAwWhcNMjcwOTA1MjE0NTAwWjBdMQs
wCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEUMBIGA1UEBwwLTW91bnR
haW4gVmlldzEPMA0GA1UECgwGR29vZ2xlMRwwGgYDVQQLDBNGZWRSQU1QIFN0b3J
hZ2UxCjAIBgNVBAMMCENBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQE
AwNBvM2I8L5sW7KpQz9xM3tLuEr5oiNVSjBu1K2JhGgX2vN3mRq4sDf8CwT9yEm
hE4F6kPgFz9x8dVuHs5jKlMbN3vR2cF8gT4eWpOiKl9yQ1mN8rP3jE2vS6uL4oT
567890abcdefghijklmnop
-----END CERTIFICATE-----`
            },
            'azure-webapp': {
                type: 'individual',
                packageName: 'healthcare-azure-ca',
                commonName: '*.internal.healthsys.com',
                issuer: 'HealthSys Azure Private CA',
                expiryDate: 'Jun 12, 2026',
                lastUpdated: '6 hours ago',
                source: 'Custom Enterprise CA',
                sourceUrl: 'https://docs.microsoft.com/azure/security/fundamentals/certificate-management/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+AzureMA0GCSqGSIb3DQEBCwUAMGExCzAJBgN
VBAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMQ8wDQYDVQQHDAZSZWRtb25kMRE
wDwYDVQQKDAhNaWNyb3NvZnQxHTAbBgNVBAsMFEF6dXJlIEdvdmVybm1lbnQxFDE
MBgNVBAMMC0F6dXJlIEdvdiBDQTAeFw0yNDA2MTIyMTQ1MDBaFw0yNjA2MTIyMTQ1
MDBaMGExCzAJBgNVBAYTAlVTMRMwEQYDVQQIDAphc2hpbmd0b24xDzANBgNVBAcM
BlJlZG1vbmQxETAPBgNVBAoMCE1pY3Jvc29mdDEdMBsGA1UECwwUQXp1cmUgR292
ZXJubWVudDEUMBIGA1UEAwwLQXp1cmUgR292IENBMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEAtFGBvN8yqL7oP9kHN2M5vWdEr8CxAzBgL4nKpUgT6H1s
9mL2rF4J8wE3QkPv5yTzLm6oP8vS9kNhF2gD7xE9Lm4pT8fJ9qW2vL3uK5oA8Bz9
567890abcdefghijklmnop
-----END CERTIFICATE-----`
            },
            'azure-keyvault': {
                type: 'individual',
                packageName: 'financial-vault-ca',
                commonName: 'vault.secure.bigbank-internal.com',
                issuer: 'BigBank Azure Key Vault CA',
                expiryDate: 'Apr 8, 2028',
                lastUpdated: '8 hours ago',
                source: 'Custom Enterprise CA',
                sourceUrl: 'https://docs.microsoft.com/azure/security/fundamentals/certificate-management/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAK8wE3z7+KeyMA0GCSqGSIb3DQEBCwUAMGQxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMQ8wDQYDVQQHDAZSZWRtb25kMRE
wDwYDVQQKDAhNaWNyb3NvZnQxIDAeBgNVBAsMF0F6dXJlIEtleSBWYXVsdCBHb3Y
xCjAIBgNVBAMMCENBMB4XDTQwNDA4MjE0NTAwWhcNMjgwNDA4MjE0NTAwWjBkMQs
wCQYDVQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3RvbjEPMA0GA1UEBwwGUmVkbW9
uZDERMA8GA1UECgwITWljcm9zb2Z0MSAwHgYDVQQLDBdBenVyZSBLZXkgVmF1bHQ
gR292MQowCAYDVQQDDAhDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggE
BALgB9K4pWnEzA8G2L5oT9vS3qNhF6mE4J8wS3kNvL9qRu4dF2pH8yE9Lm6oP8v
S9kNhF2gD7xE9Lm4pT8fJ9qW2vL3uK5oA8
567890abcdefghijklmnop
-----END CERTIFICATE-----`
            },
            'dod-pki': {
                type: 'individual',
                packageName: 'boeing-dod-eca-cert',
                commonName: 'contractor-auth.boeing.com',
                issuer: 'DoD External CA 4 (ECA)',
                expiryDate: 'Jan 24, 2027',
                lastUpdated: '1 day ago',
                source: 'DoD External Certification Authority',
                sourceUrl: 'https://public.cyber.mil/eca/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIGSzCCBDOgAwIBAgIQYZ6Q4V8Kw7VQLz0R8vwsJDANBgkqhkiG9w0BAQsFADA/
MQswCQYDVQQGEwJVUzELMAkGA1UECAwCVkExEDAOBgNVBAcMB05vcmZvbGsxETAP
BgNVBAoMCEJvZWluZyBDbzEeMBwGA1UEAwwVRG9EIEV4dGVybmFsIENBIDQgRUNB
MB4XDTIzMDcwNjAwMDAwMFoXDTI3MDcwNjIzNTk1OVowgYMxCzAJBgNVBAYTAlVT
MQswCQYDVQQIDAJXQTEQMA0GA1UEBwwGU2VhdHRsZTEWMBQGA1UECgwNQm9laW5n
IENvbXBhbnkxHDAaBgNVBAsME0NvbnRyYWN0b3IgU2VydmljZXMxHzAdBgNVBAMM
FmNvbnRyYWN0b3ItYXV0aC5ib2VpbmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
ggEKAoIBAQDLKw1A4kW8gDXJvG3rN2hF7nM5vE8Q2R7lH9kZ3vT6rF4kY8mN2B5x
P3dF7gH9vE2rL5nK8B3vR4zT6wL8N7kF3gH5I3jW2TqOB8jCB7zAdBgNVHQ4EFgQ
U7PzRw8dLN2gH3vE2rL5nK8B3vR4zT6wL8N7kF3gH5I3jW2TqOB8jCBdALBgNVHR
8EgaIwgZ+ggZyggZmGgZZodHRwOi8vY3JsLmdkcy5kaXNhLm1pbC9wa2kvRG9E
LUV4dGVybmFsJTIwQ0ElMjA0JTIwRUNBLUNSTCUyMCgxKS5jcmyCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBANQIDAQABoxAwDjAMBgNVHRMBAf8EAjAAMA0G
CSqGSIb3DQEBCwUAA4ICAQBzQ4z6QK2nV4nD3xI9FEDR1234567890abcdefghijk
lmnopqrstuvwxyzABCDEF1234567890EXTERNAL-CERT-AUTH-ECA-4
-----END CERTIFICATE-----`
            },
            'internal-ca': {
                type: 'custom',
                packageName: 'brasil-gov-icp-brasil',
                commonName: 'assinatura.gov.br',
                issuer: 'AC Raiz da ICP-Brasil v13',
                expiryDate: 'Feb 14, 2035',
                lastUpdated: '3 days ago',
                source: 'ICP-Brasil National PKI',
                fileName: 'icp-brasil-v13.p7b',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIGlzCCBH+gAwIBAgIBATANBgkqhkiG9w0BAQsFADCBgzELMAkGA1UEBhMCQlIx
HTAbBgNVBAgTFERpc3RyaXRvIEZlZGVyYWwxEjAQBgNVBAcTCUJyYXNpbGlhMRUw
EwYDVQQKEwxJVEkgLSBCcmFzaWwxKjAoBgNVBAMTIUFDIFJhaXogZGEgSUNQLUJy
YXNpbCAtIHYxMyAtIDIwMjQwHhcNMjQwMjE0MTIwMDAwWhcNMzUwMjE0MjM1OTU5
WjCBgzELMAkGA1UEBhMCQlIxHTAbBgNVBAgTFERpc3RyaXRvIEZlZGVyYWwxEjAQ
BgNVBAcTCUJyYXNpbGlhMRUwEwYDVQQKEwxJVEkgLSBCcmFzaWwxKjAoBgNVBAMT
IUFDIFJhaXogZGEgSUNQLUJyYXNpbCAtIHYxMyAtIDIwMjQwggIiMA0GCSqGSIb3
DQEBAQUAA4ICDwAwggIKAoICAQC7VJF3lKqT8wL9mN2B4pX8Z5YR2kF6gH3vE2rL
5nK8B3vR4zT6wL8N7kF3gH5I3jW2TqOB8jCBdNmF7nM5vE8Q2R7lH9kZ3vT6rF4k
Y8mN2B5xP3dF7gH9vE2rL5nK8B3vR4zT6wL8N7kF3gH5I3jW2TqOB8jCB7zAdBgN
VHQ4EFgQU7PzRw8dLN2gH3vE2rL5nK8B3vR4zT6wL8N7kF3gH5I3jW2TqOB8jCBd
ALBgNVHR8EgaIwgZ+ggZyggZmGgZZodHRwOi8vZXN0cnV0dXJhLml0aS5nb3Yu
YnIvUkVQT1NJVE9SSU8vQUMtUkFJWi9DUkwvYWNyYWl6LmNybKCBgzAdBgNVHQ4E
FgQU0K+1x7zR3vG9Q8P2wV5H4kL7yX0wDAYDVR0TAQH/BAIwADALBgNVHQ8EBAMC
AQYwIAYDVR0lAQH/BBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMA0GCSqGSIb3DQEB
CwUAA4ICAQCylJF3lKqT8wL9mN2B4pX8Z5YR2kF6gH3vE2rL5nK8B3vR4zT6wL8N
7kF3gH5I3jW2TqOB8jCBdNmF7ICP-BRASIL-NATIONAL-PKI-ROOT-CERTIFICATE-V13
-----END CERTIFICATE-----`
            },
            'aws-bundle-cert-1': {
                type: 'individual',
                packageName: 'acme-corp-microservices-cert',
                commonName: '*.microservices.acme-corp.com',
                issuer: 'ACME Corp AWS Private CA',
                expiryDate: 'Dec 31, 2027',
                lastUpdated: '1 week ago',
                source: 'AWS GovCloud FIPS',
                sourceUrl: 'https://docs.aws.amazon.com/govcloud-us/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+S3MA0GCSqGSIb3DQEBCwUAMFkxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMRAwDgYDVQQHDAeGVhdHRsZTEWMBQG
A1UECgwNQW1hem9uIEdvdkNsb3VkMRswGQYDVQQLDBJTMyBTZXJ2aWNlIEZJUFMx
CjAIBgNVBAMMCENBMB4XDTQzMTIzMTIxNDUwMFoXDTI3MTIzMTIxNDUwMFowWTEL
MAkGA1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0
bGUxFjAUBgNVBAoMDUFtYXpvbiBHb3ZDbG91ZDEbMBkGA1UECwwSUzMgU2Vydmlj
ZSBGSVBTMQ0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCxAzBgL4nKpUgT6H1s
9mL2rF4J8wE3QkPv5yTzLm6oP8vS9kNhF2gD7xE9Lm4pT8fJ9qW2vL3uK5oA8Bz9
567890abcdefghijklmnopqrstuvwxyz
-----END CERTIFICATE-----`
            },
            'aws-bundle-cert-2': {
                type: 'individual',
                packageName: 'acme-corp-database-cert',
                commonName: '*.db.acme-corp.com',
                issuer: 'ACME Corp AWS Private CA',
                expiryDate: 'Dec 31, 2027',
                lastUpdated: '1 week ago',
                source: 'AWS GovCloud FIPS',
                sourceUrl: 'https://docs.aws.amazon.com/govcloud-us/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+RdsMA0GCSqGSIb3DQEBCwUAMFkxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMRAwDgYDVQQHDAeGVhdHRsZTEWMBQG
A1UECgwNQW1hem9uIEdvdkNsb3VkMRswGQYDVQQLDBJSRFMgU2VydmljZSBGSVBT
MQowCAYDVQQDDAhDQTAeFw0yNDEyMzEyMTQ1MDBaFw0yNzEyMzEyMTQ1MDBaMFkx
CzAJBgNVBAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMRAwDgYDVQQHDAeGVhdH
bGUxFjAUBgNVBAoMDUFtYXpvbiBHb3ZDbG91ZDEbMBkGA1UECwwSUkRTIFNlcnZp
Y2UgRklQUzEKMAkGA1UEAwwCQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
AoIBAQDAwMBvN8yqL7oP9kHN2M5vWdEr8CxAzBgL4nKpUgT6H1s9mL2rF4J8wE3
QkPv5yTzLm6oP8vS9kNhF2gD7xE9Lm4pT8fJ9qW
567890abcdefghijklmnopqrstuvwxyz
-----END CERTIFICATE-----`
            },
            'aws-bundle-cert-3': {
                type: 'individual',
                packageName: 'acme-corp-serverless-cert',
                commonName: '*.serverless.acme-corp.com',
                issuer: 'ACME Corp AWS Private CA',
                expiryDate: 'Dec 31, 2027',
                lastUpdated: '1 week ago',
                source: 'AWS GovCloud FIPS',
                sourceUrl: 'https://docs.aws.amazon.com/govcloud-us/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+LamMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYXNoaW5ndG9uMRAwDgYDVQQHDAeGVhdHRsZTEWMBQG
A1UECgwNQW1hem9uIEdvdkNsb3VkMR8wHQYDVQQLDBZMYW1iZGEgU2VydmljZSBG
SVBTML1MQ0EwHhcNMjQxMjMxMjE0NTAwWhcNMjcxMjMxMjE0NTAwWjBdMQswCQYD
VQQGEwJVUzETMBEGA1UECAwKV2FzaGluZ3RvbjEQMA4GA1UEBwwHU2VhdHRsZTEW
MBQGA1UECgwNQW1hem9uIEdvdkNsb3VkMR8wHQYDVQQLDBZMYW1iZGEgU2Vydmlj
ZSBGSVBTMQowCAYDVQQDDAhDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
ggEBALRBgbzfMqi+6D/ZBzdjOb1nRK/AsQMwYC+JyqVIE+h9bPZi9qxeCfMBN0JD
7+ck8y5uqD/L0vZDYRdoA+8RPS5uKU/Hyfaltry97iuaAPAc
567890abcdefghijklmnopqrstuvwxyz
-----END CERTIFICATE-----`
            },
            'gcp-bundle-cert-1': {
                type: 'individual',
                packageName: 'techcorp-k8s-workload-cert',
                commonName: 'api.k8s.internal.techcorp.com',
                issuer: 'TechCorp Google Cloud CA Service',
                expiryDate: 'Jan 20, 2029',
                lastUpdated: '2 weeks ago',
                source: 'Google Cloud FedRAMP',
                sourceUrl: 'https://cloud.google.com/security/compliance/fedramp',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+GapMA0GCSqGSIb3DQEBCwUAMF8xCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYWxpZm9ybmlhMRQwEgYDVQQHDAtNb3VudGFpbiB
WaWV3MQ8wDQYDVQQKDAZHb29nbGUxHjAcBgNVBAsMFUZlZFJBTVAgQVBJcyBGSVBT
MQowCAYDVQQDDAhDQTAeFw0yNDAxMjAyMTQ1MDBaFw0yOTAxMjAyMTQ1MDBaMF8x
CzAJBgNVBAYTAlVTMRMwEQYDVQQIDAoXYWxpZm9ybmlhMRQwEgYDVQQHDAtNb3Vu
dGFpbiBWaWV3MQ8wDQYDVQQKDAZHb29nbGUxHjAcBgNVBAsMFUZlZFJBTVAgQVBJ
cyBGSVBTMQowCAYDVQQDDAhDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
ggEBANHvM2I8L5sW7KpQz9xM3tLuEr5oiNVSjBu1K2JhGgX2vN3mRq4sDf8CwT9y
EmhE4F6kPgFz9x8dVuHs5jKlMbN3vR2cF8gT4eWpOiKl9yQ1mN8rP3jE2vS6uL4o
T567890abcdefghijklmnopqrstuvwxyz
-----END CERTIFICATE-----`
            },
            'gcp-bundle-cert-2': {
                type: 'individual',
                packageName: 'techcorp-istio-mesh-cert',
                commonName: 'mesh.istio.internal.techcorp.com',
                issuer: 'TechCorp Service Mesh CA (GCP)',
                expiryDate: 'Jan 20, 2029',
                lastUpdated: '2 weeks ago',
                source: 'Google Cloud FedRAMP',
                sourceUrl: 'https://cloud.google.com/security/compliance/fedramp',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+IntMA0GCSqGSIb3DQEBCwUAMGMxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDAoXYWxpZm9ybmlhMRQwEgYDVQQHDAtNb3VudGFpbiB
WaWV3MQ8wDQYDVQQKDAZHb29nbGUxIjAgBgNVBAsMGUZlZFJBTVAgSW50ZXJuYWwg
RklQUzEKMAkGA1UEAwwCQ0EwHhcNMjQwMTIwMjE0NTAwWhcNMjkwMTIwMjE0NTAw
WjBjMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEUMBIGA1UEBwwL
TW91bnRhaW4gVmlldzEPMA0GA1UECgwGR29vZ2xlMSIwIAYDVQQLDBlGZWRSQU1Q
IEludGVybmFsIEZJUFMxCjAIBgNVBAMMCENBMIIBIjANBgkqhkiG9w0BAQEFAAOCA
Q8AMIIBCgKCAQEAxB2j4m87IkL0FedRAMP/OJKLNFtQkN+wH7Kp3kQCXpABCDEF
gT4eWpOiKl9yQ1mN8rP3jE2vS6uL4oT7kF2nV4nD3xI9FEDRAMP123GH5E8fw3Re
HS567890abcdefghijklmnopqrstuvwxyz
-----END CERTIFICATE-----`
            }
        };

        // Container images affected by each certificate package - Realistic Enterprise Usage
        const affectedImages = {
            'aws-ec2-internal': [
                { name: 'cgr.dev/chainguard/python', tag: '3.12-dev', lastPull: '2 hours ago' },
                { name: 'cgr.dev/chainguard/node', tag: '18-dev', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '3 days ago' },
                { name: 'cgr.dev/chainguard/postgres', tag: '16-dev', lastPull: '1 week ago' }
            ],
            'aws-elb-cert': [
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/haproxy', tag: 'latest', lastPull: '2 days ago' },
                { name: 'cgr.dev/chainguard/go', tag: '1.21-dev', lastPull: '3 days ago' }
            ],
            'aws-cloudfront': [
                { name: 'cgr.dev/chainguard/node', tag: '20-dev', lastPull: '4 hours ago' },
                { name: 'cgr.dev/chainguard/python', tag: '3.11-dev', lastPull: '6 hours ago' },
                { name: 'cgr.dev/chainguard/redis', tag: 'latest', lastPull: '1 day ago' }
            ],
            'gcp-compute': [
                { name: 'cgr.dev/chainguard/go', tag: '1.21-dev', lastPull: '3 hours ago' },
                { name: 'cgr.dev/chainguard/python', tag: '3.12-dev', lastPull: '5 hours ago' },
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/istio-proxy', tag: 'latest', lastPull: '2 days ago' }
            ],
            'gcp-storage': [
                { name: 'cgr.dev/chainguard/istio-proxy', tag: 'latest', lastPull: '12 hours ago' },
                { name: 'cgr.dev/chainguard/envoy', tag: 'latest', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '3 days ago' }
            ],
            'azure-webapp': [
                { name: 'cgr.dev/chainguard/dotnet-runtime', tag: '8.0', lastPull: '6 hours ago' },
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/postgres', tag: '16-dev', lastPull: '2 days ago' }
            ],
            'azure-keyvault': [
                { name: 'cgr.dev/chainguard/vault', tag: 'latest', lastPull: '4 hours ago' },
                { name: 'cgr.dev/chainguard/dotnet-runtime', tag: '8.0', lastPull: '8 hours ago' },
                { name: 'cgr.dev/chainguard/consul', tag: 'latest', lastPull: '1 day ago' }
            ],
            'dod-pki': [
                { name: 'cgr.dev/chainguard/nginx-fips', tag: 'dod-stig-v2', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/python-fips', tag: '3.12-dod-stig', lastPull: '3 days ago' },
                { name: 'cgr.dev/chainguard/go-fips', tag: '1.21-dod-stig', lastPull: '4 days ago' },
                { name: 'cgr.dev/chainguard/jdk-fips', tag: 'openjdk-17-dod-stig', lastPull: '5 days ago' }
            ],
            'internal-ca': [
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '2 hours ago' },
                { name: 'cgr.dev/chainguard/python', tag: '3.11-dev', lastPull: '6 hours ago' },
                { name: 'cgr.dev/chainguard/postgres', tag: '16-dev', lastPull: '1 day ago' }
            ],
            'aws-bundle-cert-1': [
                { name: 'cgr.dev/chainguard/python', tag: '3.12-dev', lastPull: '4 hours ago' },
                { name: 'cgr.dev/chainguard/go', tag: '1.21-dev', lastPull: '1 week ago' },
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '1 week ago' }
            ],
            'aws-bundle-cert-2': [
                { name: 'cgr.dev/chainguard/postgres', tag: '16-dev', lastPull: '2 days ago' },
                { name: 'cgr.dev/chainguard/redis', tag: 'latest', lastPull: '1 week ago' }
            ],
            'aws-bundle-cert-3': [
                { name: 'cgr.dev/chainguard/python', tag: '3.11-dev', lastPull: '6 hours ago' },
                { name: 'cgr.dev/chainguard/node', tag: '18-dev', lastPull: '1 week ago' }
            ],
            'gcp-bundle-cert-1': [
                { name: 'cgr.dev/chainguard/go', tag: '1.21-dev', lastPull: '1 day ago' },
                { name: 'cgr.dev/chainguard/istio-proxy', tag: 'latest', lastPull: '2 weeks ago' },
                { name: 'cgr.dev/chainguard/nginx', tag: 'latest', lastPull: '2 weeks ago' }
            ],
            'gcp-bundle-cert-2': [
                { name: 'cgr.dev/chainguard/envoy', tag: 'latest', lastPull: '8 hours ago' },
                { name: 'cgr.dev/chainguard/istio-proxy', tag: 'latest', lastPull: '2 weeks ago' }
            ]
        };

        function openPanel() {
            console.log('Opening panel...');
            document.getElementById('panelOverlay').classList.remove('hidden');
        }

        function closePanel() {
            console.log('Closing panel...');
            document.getElementById('panelOverlay').classList.add('hidden');
            resetToSelection();
        }

        function showUpload() {
            console.log('Showing upload...');
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-upload').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            currentStep = 'upload';
        }

        function showSuggestions() {
            console.log('Showing suggestions...');
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-suggestions').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            currentStep = 'suggestions';
        }

        function selectBundle(bundleId, element) {
            console.log('Selected bundle:', bundleId);
            selectedBundle = bundleId;

            // Reset all options
            document.querySelectorAll('.certificate-option').forEach(opt => {
                opt.classList.remove('border-chainguard-teal', 'bg-chainguard-teal/5');
                opt.classList.add('border-gray-600');
            });

            // Select this option
            element.classList.remove('border-gray-600');
            element.classList.add('border-chainguard-teal', 'bg-chainguard-teal/5');

            // Show next button
            document.getElementById('nextBtn').classList.remove('hidden');
        }


        function goBack() {
            if (currentStep === 'details') {
                document.getElementById('step-details').classList.add('hidden');
                if (selectedBundle) {
                    document.getElementById('step-suggestions').classList.remove('hidden');
                    currentStep = 'suggestions';
                } else {
                    document.getElementById('step-upload').classList.remove('hidden');
                    currentStep = 'upload';
                }
                document.getElementById('nextBtn').innerHTML = 'Next <i data-lucide="arrow-right" class="lucide"></i>';
                lucide.createIcons();
            } else if (currentStep === 'suggestions' || currentStep === 'upload') {
                resetToSelection();
            }
        }

        function resetToSelection() {
            document.getElementById('step-details').classList.add('hidden');
            document.getElementById('step-suggestions').classList.add('hidden');
            document.getElementById('step-upload').classList.add('hidden');
            document.getElementById('step-selection').classList.remove('hidden');
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');

            // Reset header
            const header = document.querySelector('#panelOverlay h2');
            header.textContent = 'Create Custom Package';

            // Reset next button
            document.getElementById('nextBtn').innerHTML = 'Next <i data-lucide="arrow-right" class="lucide"></i>';
            document.getElementById('nextBtn').onclick = proceedNext;

            // Remove edit/delete buttons if they exist
            const cancelBtn = document.getElementById('cancelBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            if (cancelBtn) cancelBtn.remove();
            if (deleteBtn) deleteBtn.remove();

            // Reset package name input
            const packageNameInput = document.getElementById('packageNameInput');
            packageNameInput.disabled = false;
            packageNameInput.value = '';

            // Reset selections
            document.querySelectorAll('.certificate-option').forEach(opt => {
                opt.classList.remove('border-chainguard-teal', 'bg-chainguard-teal/5');
                opt.classList.add('border-gray-600');
            });

            selectedBundle = null;
            uploadedFile = null;
            uploadedFileContent = null;
            currentViewingCert = null;
            isEditMode = false;
            currentStep = 'selection';

            // Reset upload form
            document.getElementById('file-input').value = '';
            document.getElementById('certificate-preview').classList.add('hidden');
            document.getElementById('upload-package-name').value = '';
        }

        function addPackageToTable(packageName, bundleType) {
            const tableBody = document.getElementById('packagesTable');
            const newRow = document.createElement('div');
            newRow.className = 'hover:bg-gray-800/30 transition-colors cursor-pointer';

            let commonName, issuer, expiry;
            if (bundleType === 'aws-pca') {
                commonName = '*.amazonaws.com CA';
                issuer = 'Amazon Root CA';
                expiry = 'Dec 31, 2030';
            } else if (bundleType === 'gcp-ca') {
                commonName = '*.googleapis.com CA';
                issuer = 'Google Trust Services';
                expiry = 'Jan 15, 2029';
            } else if (bundleType === 'dod-eca') {
                commonName = '*.dod.mil CA';
                issuer = 'DoD Root CA';
                expiry = 'Jan 15, 2028';
            } else if (bundleType === 'dod-wcf') {
                commonName = '*.dod.mil WCF CA';
                issuer = 'DoD WCF Root CA';
                expiry = 'Dec 31, 2029';
            } else if (bundleType === 'icp-brazil') {
                commonName = '*.gov.br CA';
                issuer = 'ICP-Brasil Root CA';
                expiry = 'Jun 30, 2030';
            }

            newRow.innerHTML = `
                <div class="px-2 py-2">
                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                        <div class="text-chainguard-teal font-medium" style="width: 238px;">${packageName}</div>
                        <div class="text-white" style="width: 209px;">${commonName}</div>
                        <div class="text-white" style="width: 159px;">${issuer}</div>
                        <div class="text-white" style="width: 132px;">${expiry}</div>
                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">Just now</div>
                    </div>
                </div>
            `;
            tableBody.insertBefore(newRow, tableBody.firstChild);
        }

        function toggleBundle(element) {
            const bundleContent = element.parentElement.querySelector('.bundle-content');
            const arrow = element.querySelector('.bundle-arrow');

            if (bundleContent.classList.contains('hidden')) {
                bundleContent.classList.remove('hidden');
                arrow.style.transform = 'rotate(90deg)';
            } else {
                bundleContent.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // File upload functionality
        function initializeUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');

            // Drag & drop handlers
            uploadArea.addEventListener('dragenter', handleDragEnter);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => fileInput.click());

            // File input handler
            fileInput.addEventListener('change', handleFileSelect);
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('upload-area').classList.add('drag-active');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            if (!e.currentTarget.contains(e.relatedTarget)) {
                document.getElementById('upload-area').classList.remove('drag-active');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('upload-area').classList.remove('drag-active');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processUploadedFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                processUploadedFile(files[0]);
            }
        }

        function processUploadedFile(file) {
            // Validate file type
            const validExtensions = ['.pem', '.crt', '.cer', '.p7b', '.p7c'];
            const fileName = file.name.toLowerCase();
            const isValid = validExtensions.some(ext => fileName.endsWith(ext));

            if (!isValid) {
                alert('Please upload a valid certificate file (PEM, CRT, CER, PKCS#7)');
                return;
            }

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size too large. Please upload a file smaller than 10MB.');
                return;
            }

            uploadedFile = file;

            // Read file content
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedFileContent = e.target.result;
                displayCertificatePreview(uploadedFileContent);

                // Auto-generate package name
                const baseName = file.name.replace(/\.[^/.]+$/, '');
                document.getElementById('upload-package-name').value = `custom-cert-${baseName}`;

                // Show next button
                document.getElementById('nextBtn').classList.remove('hidden');
            };
            reader.readAsText(file);
        }

        function displayCertificatePreview(content) {
            const preview = document.getElementById('certificate-preview');
            const lineNumbers = document.getElementById('line-numbers');
            const contentDiv = document.getElementById('certificate-content');

            // Show preview
            preview.classList.remove('hidden');

            // Preserve original PEM formatting for proper certificate display
            const lines = content.split('\n');

            // Generate line numbers
            lineNumbers.innerHTML = lines.map((_, i) => `<div class="leading-tight">${i + 1}</div>`).join('');

            // Display content preserving original PEM structure
            contentDiv.innerHTML = lines.map(line => `<div class="leading-tight break-all">${line.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>`).join('');
        }

        function proceedNext() {
            console.log('Proceeding to next step, current:', currentStep, 'selected:', selectedBundle);

            if (currentStep === 'upload' && uploadedFile) {
                // Show package configuration for uploaded file
                document.getElementById('step-upload').classList.add('hidden');
                document.getElementById('step-details').classList.remove('hidden');
                document.getElementById('nextBtn').innerHTML = 'Create Package <i data-lucide="arrow-right" class="lucide"></i>';
                lucide.createIcons();
                currentStep = 'details';

                // Set package name and bundle info for uploaded file
                const packageNameInput = document.getElementById('packageNameInput');
                const bundleInfo = document.getElementById('selected-bundle-info');

                packageNameInput.value = document.getElementById('upload-package-name').value;
                bundleInfo.innerHTML = `
                    <div class="w-full">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                                <i data-lucide="file-text" class="lucide text-chainguard-teal" style="width: 0.875rem; height: 0.875rem;"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-white">Uploaded Certificate</h4>
                                <p class="text-xs text-gray-400">Custom certificate bundle uploaded from file</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                            <div><span class="text-gray-400">File:</span><div class="text-white text-xs break-all mt-1">${uploadedFile.name}</div></div>
                            <div><span class="text-gray-400">Size:</span><div class="text-white text-xs mt-1">${(uploadedFile.size / 1024).toFixed(1)} KB</div></div>
                            <div><span class="text-gray-400">Type:</span><div class="text-white text-xs mt-1">Custom Upload</div></div>
                            <div><span class="text-gray-400">Format:</span><div class="text-white text-xs mt-1">${uploadedFile.name.split('.').pop().toUpperCase()}</div></div>
                        </div>
                        <div class="mt-2 p-2 rounded bg-yellow-500/10 border border-yellow-500/20">
                            <p class="text-xs text-yellow-400">⚠️ This is a custom upload. You'll need to manually update this package when certificates change.</p>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            } else if (currentStep === 'suggestions' && selectedBundle) {
                // Show package configuration for curated bundle
                document.getElementById('step-suggestions').classList.add('hidden');
                document.getElementById('step-details').classList.remove('hidden');
                document.getElementById('nextBtn').innerHTML = 'Create Package <i data-lucide="arrow-right" class="lucide"></i>';
                lucide.createIcons();
                currentStep = 'details';

                // Set package name and bundle info
                const packageNameInput = document.getElementById('packageNameInput');
                const bundleInfo = document.getElementById('selected-bundle-info');

                if (selectedBundle === 'aws-pca') {
                    console.log('Showing AWS bundle info');
                    packageNameInput.value = 'aws-private-ca-package';
                    bundleInfo.innerHTML = `
                        <div class="w-full">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                                    <i data-lucide="cloud" class="lucide text-orange-400" style="width: 0.875rem; height: 0.875rem;"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-white">AWS Private CA Bundle</h4>
                                    <p class="text-xs text-gray-400">Amazon Web Services Private Certificate Authority trusted roots</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                                <div><span class="text-gray-400">Version:</span><div class="text-white text-xs font-mono mt-1">Latest</div></div>
                                <div><span class="text-gray-400">Certificates:</span><div class="text-white text-xs mt-1">6</div></div>
                                <div><span class="text-gray-400">Provider:</span><div class="text-white text-xs mt-1">Amazon Web Services</div></div>
                                <div><span class="text-gray-400">Last Updated:</span><div class="text-white text-xs mt-1">Sep 10, 2024</div></div>
                            </div>
                            <div class="mt-2 p-2 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                <p class="text-xs text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                            </div>
                        </div>
                    `;
                } else if (selectedBundle === 'gcp-ca') {
                    console.log('Showing GCP bundle info');
                    packageNameInput.value = 'gcp-ca-service-package';
                    bundleInfo.innerHTML = `
                        <div class="w-full">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                                    <i data-lucide="cloud" class="lucide text-purple-400" style="width: 0.875rem; height: 0.875rem;"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-white">Google Cloud Certificate Authority Service</h4>
                                    <p class="text-xs text-gray-400">Google Cloud Platform managed certificate authorities</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                                <div><span class="text-gray-400">Version:</span><div class="text-white text-xs font-mono mt-1">Latest</div></div>
                                <div><span class="text-gray-400">Certificates:</span><div class="text-white text-xs mt-1">4</div></div>
                                <div><span class="text-gray-400">Provider:</span><div class="text-white text-xs mt-1">Google Cloud</div></div>
                                <div><span class="text-gray-400">Last Updated:</span><div class="text-white text-xs mt-1">Sep 5, 2024</div></div>
                            </div>
                            <div class="mt-2 p-2 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                <p class="text-xs text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                            </div>
                        </div>
                    `;
                } else if (selectedBundle === 'dod-eca') {
                    console.log('Showing DoD ECA bundle info');
                    packageNameInput.value = 'dod-eca-pki-package';
                    bundleInfo.innerHTML = `
                        <div class="w-full">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                                    <i data-lucide="building-2" class="lucide text-blue-400" style="width: 0.875rem; height: 0.875rem;"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-white">DoD PKCS#7 for ECA PKI Only</h4>
                                    <p class="text-xs text-gray-400">US Department of Defense Enterprise Certificate Authority</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                                <div><span class="text-gray-400">Version:</span><div class="text-white text-xs font-mono mt-1">5.12</div></div>
                                <div><span class="text-gray-400">Certificates:</span><div class="text-white text-xs mt-1">12</div></div>
                                <div><span class="text-gray-400">Provider:</span><div class="text-white text-xs mt-1">US Department of Defense</div></div>
                                <div><span class="text-gray-400">Last Updated:</span><div class="text-white text-xs mt-1">Aug 15, 2024</div></div>
                            </div>
                            <div class="mt-2 p-2 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                <p class="text-xs text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                            </div>
                        </div>
                    `;
                } else if (selectedBundle === 'dod-wcf') {
                    console.log('Showing DoD WCF bundle info');
                    packageNameInput.value = 'dod-wcf-pki-package';
                    bundleInfo.innerHTML = `
                        <div class="w-full">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                                    <i data-lucide="building-2" class="lucide text-blue-400" style="width: 0.875rem; height: 0.875rem;"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-white">DoD PKI CA Certificate Bundles: PKCS#7 for WCF B&I PKI</h4>
                                    <p class="text-xs text-gray-400">DoD Web Communications Framework for business and intelligence operations</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                                <div><span class="text-gray-400">Version:</span><div class="text-white text-xs font-mono mt-1">5.17</div></div>
                                <div><span class="text-gray-400">Certificates:</span><div class="text-white text-xs mt-1">8</div></div>
                                <div><span class="text-gray-400">Provider:</span><div class="text-white text-xs mt-1">US Department of Defense</div></div>
                                <div><span class="text-gray-400">Last Updated:</span><div class="text-white text-xs mt-1">Sep 1, 2024</div></div>
                            </div>
                            <div class="mt-2 p-2 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                <p class="text-xs text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                            </div>
                        </div>
                    `;
                } else if (selectedBundle === 'icp-brazil') {
                    console.log('Showing Brazilian PKI bundle info');
                    packageNameInput.value = 'icp-brazil-pki-package';
                    bundleInfo.innerHTML = `
                        <div class="w-full">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                                    <i data-lucide="globe" class="lucide text-green-400" style="width: 0.875rem; height: 0.875rem;"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-white">PKI ICP Brazil</h4>
                                    <p class="text-xs text-gray-400">Brazilian Public Key Infrastructure for government and enterprise use</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                                <div><span class="text-gray-400">Version:</span><div class="text-white text-xs font-mono mt-1">2024.1</div></div>
                                <div><span class="text-gray-400">Certificates:</span><div class="text-white text-xs mt-1">24</div></div>
                                <div><span class="text-gray-400">Provider:</span><div class="text-white text-xs mt-1">Brazilian Government</div></div>
                                <div><span class="text-gray-400">Last Updated:</span><div class="text-white text-xs mt-1">Jul 20, 2024</div></div>
                            </div>
                            <div class="mt-2 p-2 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                <p class="text-xs text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                            </div>
                        </div>
                    `;
                }

                lucide.createIcons();
            } else if (currentStep === 'details') {
                // Create package
                const packageName = document.getElementById('packageNameInput').value;
                console.log('Creating package:', packageName);

                // Show notification
                document.getElementById('notification').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('notification').classList.add('hidden');
                }, 5000);

                // Add to table
                addPackageToTable(packageName, selectedBundle);
                closePanel();
            }
        }

        // View/Edit/Delete functionality
        function viewCertificate(certId) {
            console.log('Viewing certificate:', certId);
            currentViewingCert = certId;
            isEditMode = false;

            const cert = certificateData[certId];
            if (!cert) {
                console.error('Certificate not found:', certId);
                return;
            }

            // Open panel and set to view mode
            document.getElementById('panelOverlay').classList.remove('hidden');

            // Hide all steps
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-suggestions').classList.add('hidden');
            document.getElementById('step-upload').classList.add('hidden');
            document.getElementById('step-details').classList.remove('hidden');

            // Update header for view mode
            const header = document.querySelector('#panelOverlay h2');
            header.textContent = 'View Certificate Package';

            // Populate certificate information
            const packageNameInput = document.getElementById('packageNameInput');
            const bundleInfo = document.getElementById('selected-bundle-info');

            packageNameInput.value = cert.packageName;
            packageNameInput.disabled = true; // Start in view mode

            // Create view content based on certificate type
            bundleInfo.innerHTML = createCertificateViewContent(cert);

            // Update footer buttons for view mode
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('nextBtn').innerHTML = 'Edit Package <i data-lucide="edit" class="lucide"></i>';
            document.getElementById('nextBtn').classList.remove('hidden');
            document.getElementById('nextBtn').onclick = () => editCertificate(certId);

            // Add delete button
            if (!document.getElementById('deleteBtn')) {
                const deleteBtn = document.createElement('button');
                deleteBtn.id = 'deleteBtn';
                deleteBtn.onclick = () => showDeleteDialog(certId);
                deleteBtn.className = 'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium flex items-center gap-2 transition-colors';
                deleteBtn.innerHTML = '<i data-lucide="trash-2" class="lucide"></i>Delete';
                document.querySelector('#panelOverlay .p-6.border-t .flex.gap-3').appendChild(deleteBtn);
            }

            lucide.createIcons();
            currentStep = 'view';
        }

        function createCertificateViewContent(cert) {
            const iconType = cert.type === 'custom' ? 'file-text' : (cert.source.includes('AWS') ? 'cloud' : cert.source.includes('Google') ? 'cloud' : cert.source.includes('DoD') ? 'building-2' : 'shield');
            const iconColor = cert.type === 'custom' ? 'chainguard-teal' : (cert.source.includes('AWS') ? 'orange-400' : cert.source.includes('Google') ? 'purple-400' : 'blue-400');

            return `
                <div class="w-full">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="flex-shrink-0 p-1.5 rounded bg-white/5">
                            <i data-lucide="${iconType}" class="lucide text-${iconColor}" style="width: 0.875rem; height: 0.875rem;"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-sm font-medium text-white">${cert.packageName}</h4>
                            <p class="text-xs text-gray-400">${cert.type === 'custom' ? 'Custom uploaded certificate' : cert.source + ' managed certificate'}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 text-xs mb-3">
                        <div><span class="text-gray-400">Common Name:</span><div class="text-white text-xs break-all mt-1">${cert.commonName}</div></div>
                        <div><span class="text-gray-400">Issuer:</span><div class="text-white text-xs break-all mt-1">${cert.issuer}</div></div>
                        <div><span class="text-gray-400">Expires:</span><div class="text-white text-xs mt-1">${cert.expiryDate}</div></div>
                        <div><span class="text-gray-400">Last Updated:</span><div class="text-white text-xs mt-1">${cert.lastUpdated}</div></div>
                    </div>

                    ${cert.type === 'custom' ?
                        `<div class="mt-2 p-2 rounded bg-yellow-500/10 border border-yellow-500/20">
                            <p class="text-xs text-yellow-400">⚠️ Custom upload - manual updates required</p>
                        </div>` :
                        `<div class="mt-2 p-2 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                            <p class="text-xs text-chainguard-teal">✓ Auto-updating managed certificate</p>
                        </div>`
                    }

                    <div class="mt-3">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="text-xs font-medium text-white">Certificate Content</h5>
                            ${cert.sourceUrl ? `<a href="${cert.sourceUrl}" target="_blank" class="text-xs text-chainguard-teal hover:underline">Source: ${cert.source}</a>` : `<span class="text-xs text-gray-400">${cert.source}</span>`}
                        </div>
                        <div class="bg-chainguard-darker border border-gray-600 rounded overflow-hidden">
                            <div class="relative">
                                <div class="absolute left-1 top-1 text-xs text-gray-500 font-mono leading-tight text-right w-6 select-none z-10">
                                    ${cert.certificateContent.split('\n').map((_, i) => `<div class="leading-tight">${i + 1}</div>`).join('')}
                                </div>
                                <div class="pl-8 pr-2 py-1 text-xs font-mono text-gray-300 leading-tight max-h-40 overflow-y-auto">
                                    ${cert.certificateContent.split('\n').map(line => `<div class="leading-tight break-all">${line.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function editCertificate(certId) {
            console.log('Editing certificate:', certId);
            isEditMode = true;
            const cert = certificateData[certId];

            // Update header
            const header = document.querySelector('#panelOverlay h2');
            header.textContent = 'Edit Certificate Package';

            // Enable package name editing
            const packageNameInput = document.getElementById('packageNameInput');
            packageNameInput.disabled = false;
            packageNameInput.focus();

            // Replace certificate content display with editable textarea
            const certContentContainer = document.querySelector('#panelOverlay .bg-chainguard-darker.border.border-gray-600.rounded.overflow-hidden');
            if (certContentContainer) {
                certContentContainer.innerHTML = `
                    <div class="p-3">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Certificate Content</label>
                        <textarea
                            id="certificateContentTextarea"
                            class="w-full h-40 bg-chainguard-darker border border-gray-600 rounded text-xs font-mono text-gray-300 p-2 resize-none"
                            placeholder="Paste your certificate content here..."
                        >${cert.certificateContent}</textarea>
                        <p class="text-xs text-gray-500 mt-1">Edit the certificate content for rotation or updates. Include the full certificate chain if needed.</p>
                    </div>
                `;
            }

            // Update footer buttons for edit mode
            document.getElementById('nextBtn').innerHTML = 'Save Changes <i data-lucide="save" class="lucide"></i>';
            document.getElementById('nextBtn').onclick = () => saveCertificateChanges(certId);

            // Add cancel button
            if (!document.getElementById('cancelBtn')) {
                const cancelBtn = document.createElement('button');
                cancelBtn.id = 'cancelBtn';
                cancelBtn.onclick = () => viewCertificate(certId); // Return to view mode
                cancelBtn.className = 'px-4 py-2 text-gray-300 hover:text-white transition-colors';
                cancelBtn.innerHTML = 'Cancel';
                document.querySelector('#panelOverlay .p-6.border-t .flex').insertBefore(cancelBtn, document.getElementById('nextBtn'));
            }

            lucide.createIcons();
            currentStep = 'edit';
        }

        function saveCertificateChanges(certId) {
            console.log('Saving changes for certificate:', certId);

            const newPackageName = document.getElementById('packageNameInput').value.trim();
            const newCertificateContent = document.getElementById('certificateContentTextarea')?.value.trim();

            // Validate package name
            if (!newPackageName) {
                alert('Package name is required');
                return;
            }

            // Validate certificate content (only for custom uploaded certificates)
            const cert = certificateData[certId];
            if (cert && cert.type === 'individual' && newCertificateContent) {
                // Basic validation for certificate format
                if (!newCertificateContent.includes('BEGIN CERTIFICATE') || !newCertificateContent.includes('END CERTIFICATE')) {
                    if (!confirm('The certificate content doesn\'t appear to be in standard PEM format. Do you want to save it anyway?')) {
                        return;
                    }
                }
            }

            // Update certificate data
            if (certificateData[certId]) {
                certificateData[certId].packageName = newPackageName;
                certificateData[certId].lastUpdated = 'Just now';

                // Update certificate content if it was edited
                if (newCertificateContent && cert.type === 'individual') {
                    certificateData[certId].certificateContent = newCertificateContent;
                }
            }

            // Update table row
            const tableRow = document.querySelector(`[data-cert-id="${certId}"]`);
            if (tableRow) {
                const nameCell = tableRow.querySelector('.text-chainguard-teal');
                nameCell.textContent = newPackageName;
                const updatedCell = tableRow.querySelector('.text-right');
                updatedCell.textContent = 'Just now';
            }

            // Show success notification with appropriate message
            const message = newCertificateContent && cert.type === 'individual'
                ? 'Certificate package and content updated successfully! Certificate rotation complete.'
                : 'Certificate package updated successfully!';
            showNotification(message, 'success');

            // Return to view mode
            viewCertificate(certId);
        }

        function showDeleteDialog(certId) {
            console.log('Showing delete dialog for:', certId);
            certificateToDelete = certId;

            const cert = certificateData[certId];
            document.getElementById('delete-cert-name').textContent = cert.packageName;

            // Populate affected images
            const imagesList = document.getElementById('affected-images-list');
            const images = affectedImages[certId] || [];

            if (images.length === 0) {
                imagesList.innerHTML = `
                    <div class="text-xs text-gray-500 italic">No container images are currently using this certificate package.</div>
                `;
            } else {
                imagesList.innerHTML = images.map(image => `
                    <div class="flex items-center justify-between py-2 px-3 bg-gray-800/30 rounded border border-gray-700/50">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded bg-chainguard-teal/10 flex items-center justify-center">
                                <i data-lucide="package" class="h-4 w-4 text-chainguard-teal"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-white font-mono">${image.name}</div>
                                <div class="text-xs text-gray-400">Tag: ${image.tag}</div>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500">
                            Last pull: ${image.lastPull}
                        </div>
                    </div>
                `).join('');
            }

            // Re-initialize lucide icons for the newly added content
            lucide.createIcons();

            document.getElementById('deleteDialog').classList.remove('hidden');
        }

        function cancelDelete() {
            console.log('Cancelling delete');
            document.getElementById('deleteDialog').classList.add('hidden');
            certificateToDelete = null;
        }

        function confirmDelete() {
            console.log('Confirming delete for:', certificateToDelete);

            if (certificateToDelete) {
                // Remove from data
                delete certificateData[certificateToDelete];

                // Remove from table
                const tableRow = document.querySelector(`[data-cert-id="${certificateToDelete}"]`);
                if (tableRow) {
                    // Handle bundle deletion
                    if (tableRow.closest('.expandable-bundle')) {
                        tableRow.closest('.expandable-bundle').remove();
                    } else {
                        tableRow.remove();
                    }
                }

                // Close dialogs
                document.getElementById('deleteDialog').classList.add('hidden');
                document.getElementById('panelOverlay').classList.add('hidden');

                // Show success notification
                showNotification('Certificate package deleted successfully!', 'success');

                // Reset state
                certificateToDelete = null;
                currentViewingCert = null;
                resetToSelection();
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `fixed top-4 right-4 z-[110] px-4 py-3 rounded-lg ${
                type === 'success' ? 'bg-green-500/20 border border-green-500/40 text-green-400' :
                type === 'error' ? 'bg-red-500/20 border border-red-500/40 text-red-400' :
                'bg-blue-500/20 border border-blue-500/40 text-blue-400'
            }`;
            notification.classList.remove('hidden');

            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }

        function generateSampleImages(bundleType, packageName) {
            // FIPS-compliant images for FedRAMP environment
            const fipsImages = [
                'cgr.dev/chainguard/python-fips',
                'cgr.dev/chainguard/node-fips',
                'cgr.dev/chainguard/go-fips',
                'cgr.dev/chainguard/jdk-fips',
                'cgr.dev/chainguard/chainguard-base-fips',
                'cgr.dev/chainguard/nginx-fips',
                'cgr.dev/chainguard/vault-fips',
                'cgr.dev/chainguard/postgres-fips',
                'cgr.dev/chainguard/dotnet-runtime-fips'
            ];

            // FIPS tags based on bundle type and FedRAMP requirements
            const fipsTags = {
                'aws-pca': ['3.12-fips-aws-gov', '18-fips-aws-gov', '1.21-fips-aws-gov', 'latest-fips-aws-gov'],
                'gcp-ca': ['3.12-fips-fedramp', '18-fips-fedramp', '1.21-fips-fedramp', 'latest-fips-fedramp'],
                'dod-eca': ['3.12-dod-stig-v2', '18-dod-stig-v2', '1.21-dod-stig-v2', 'openjdk-17-dod-stig'],
                'dod-wcf': ['3.12-dod-wcf-stig', '18-dod-wcf-stig', '1.21-dod-wcf-stig', 'latest-dod-wcf'],
                'icp-brazil': ['3.12-fips-brazil-gov', '18-fips-brazil-gov', '1.21-fips-brazil-gov', 'latest-fips-brazil'],
                'default': ['3.12-fips-stig', '18-fips-stig', '1.21-fips-stig', 'latest-fips-stig']
            };

            const timeUnits = ['minutes', 'hours', 'days'];
            const availableTags = fipsTags[bundleType] || fipsTags['default'];

            // Generate 2-4 random FIPS images for this package
            const numImages = Math.floor(Math.random() * 3) + 2;
            const selectedImages = [];

            for (let i = 0; i < numImages; i++) {
                const randomImage = fipsImages[Math.floor(Math.random() * fipsImages.length)];
                const randomTag = availableTags[Math.floor(Math.random() * availableTags.length)];
                const randomTime = Math.floor(Math.random() * 168) + 1; // 1-168 hours (1 week)
                const randomUnit = timeUnits[Math.floor(Math.random() * timeUnits.length)];

                selectedImages.push({
                    name: randomImage,
                    tag: randomTag,
                    lastPull: `${randomTime} ${randomUnit} ago`
                });
            }

            return selectedImages;
        }

        // Update addPackageToTable to include certificate data
        function addPackageToTable(packageName, bundleType) {
            const tableBody = document.getElementById('packagesTable');
            const newRow = document.createElement('div');
            newRow.className = 'certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer';

            let commonName, issuer, expiry, certId;
            if (bundleType === 'aws-pca') {
                commonName = '*.amazonaws.com CA';
                issuer = 'Amazon Root CA';
                expiry = 'Dec 31, 2030';
                certId = 'new-aws-' + Date.now();
            } else if (bundleType === 'gcp-ca') {
                commonName = '*.googleapis.com CA';
                issuer = 'Google Trust Services';
                expiry = 'Jan 15, 2029';
                certId = 'new-gcp-' + Date.now();
            } else if (bundleType === 'dod-eca') {
                commonName = '*.dod.mil CA';
                issuer = 'DoD Root CA';
                expiry = 'Jan 15, 2028';
                certId = 'new-dod-' + Date.now();
            } else if (bundleType === 'dod-wcf') {
                commonName = '*.dod.mil WCF CA';
                issuer = 'DoD WCF Root CA';
                expiry = 'Dec 31, 2029';
                certId = 'new-dod-wcf-' + Date.now();
            } else if (bundleType === 'icp-brazil') {
                commonName = '*.gov.br CA';
                issuer = 'ICP-Brasil Root CA';
                expiry = 'Jun 30, 2030';
                certId = 'new-brazil-' + Date.now();
            } else {
                // Custom upload
                commonName = uploadedFile ? `*.${uploadedFile.name.split('.')[0]}.local` : '*.custom.local';
                issuer = 'Custom Root CA';
                expiry = 'Dec 31, 2025';
                certId = 'custom-' + Date.now();
            }

            // Add to certificate database
            certificateData[certId] = {
                type: bundleType ? 'curated' : 'custom',
                packageName: packageName,
                commonName: commonName,
                issuer: issuer,
                expiryDate: expiry,
                lastUpdated: 'Just now',
                source: bundleType ? (
                    bundleType === 'aws-pca' ? 'AWS Private CA' :
                    bundleType === 'gcp-ca' ? 'Google Cloud' :
                    bundleType === 'dod-eca' ? 'DoD ECA PKI' :
                    bundleType === 'dod-wcf' ? 'DoD WCF PKI' :
                    bundleType === 'icp-brazil' ? 'Brazilian PKI' :
                    'DoD PKI'
                ) : 'Custom Upload',
                sourceUrl: bundleType ? (
                    bundleType === 'aws-pca' ? 'https://docs.aws.amazon.com/privateca/' :
                    bundleType === 'gcp-ca' ? 'https://cloud.google.com/security/products/certificate-authority-service' :
                    bundleType === 'icp-brazil' ? 'https://www.iti.gov.br/icp-brasil' :
                    'https://www.cyber.mil/pki-pke/tools-configuration-files/'
                ) : null,
                fileName: uploadedFile ? uploadedFile.name : null,
                certificateContent: uploadedFileContent || '-----BEGIN CERTIFICATE-----\n[Certificate content would be displayed here]\n-----END CERTIFICATE-----'
            };

            // Add sample affected images for new packages
            affectedImages[certId] = generateSampleImages(bundleType, packageName);

            newRow.setAttribute('data-cert-type', certificateData[certId].type);
            newRow.setAttribute('data-cert-id', certId);
            newRow.onclick = () => viewCertificate(certId);

            newRow.innerHTML = `
                <div class="px-2 py-2">
                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                        <div class="text-chainguard-teal font-medium" style="width: 238px;">${packageName}</div>
                        <div class="text-white" style="width: 209px;">${commonName}</div>
                        <div class="text-white" style="width: 159px;">${issuer}</div>
                        <div class="text-white" style="width: 132px;">${expiry}</div>
                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">Just now</div>
                    </div>
                </div>
            `;
            tableBody.insertBefore(newRow, tableBody.firstChild);
        }

        // Initialize
        document.getElementById('createPackageBtn').addEventListener('click', openPanel);
        initializeUpload();
    </script>
</body>
</html>