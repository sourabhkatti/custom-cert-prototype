<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chainguard Custom Packages - Certificate Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chainguard-dark': '#14003D',
                        'chainguard-darker': '#110033',
                        'chainguard-teal': '#7AF0FE',
                        'chainguard-text-secondary': '#c5c5c5',
                    },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #110033;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .lucide { width: 1rem; height: 1rem; }
        .lucide-lg { width: 1.25rem; height: 1.25rem; }
        .text-chainguard-text-secondary { color: #c5c5c5; }
        .border-chainguard-teal { border-color: #7AF0FE; }
        .bg-chainguard-teal { background-color: #7AF0FE; }
        .text-chainguard-teal { color: #7AF0FE; }
        .bg-chainguard-dark { background-color: #14003D; }
        .bg-chainguard-darker { background-color: #110033; }

        /* Enhanced hover states */
        .certificate-row:hover .text-chainguard-teal {
            text-decoration: underline;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Smooth transitions */
        .bundle-arrow {
            transition: transform 0.2s ease;
        }

        /* Enhanced drag states */
        .drag-active {
            border-color: #7AF0FE !important;
            background-color: rgba(122, 240, 254, 0.05) !important;
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="flex min-h-screen">
        <!-- Navigation -->
        <nav class="w-72 h-screen p-6 border-r border-gray-700" style="background-color: #14003D;">
            <div class="mb-6">
                <div class="flex items-center gap-2 mb-6">
                    <div class="w-6 h-6 bg-chainguard-teal rounded"></div>
                    <span class="text-white font-bold text-lg">chainguard</span>
                </div>
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-7 h-7 rounded-full bg-gray-600 flex items-center justify-center">
                        <i data-lucide="user" class="lucide text-white"></i>
                    </div>
                    <div class="flex items-center gap-2 bg-gray-700/30 rounded-full px-3 py-1">
                        <span class="text-chainguard-teal text-sm font-medium">cloud-services.com</span>
                        <i data-lucide="chevron-down" class="lucide text-chainguard-teal" style="width: 12px; height: 12px;"></i>
                    </div>
                </div>
            </div>

            <ul class="space-y-1">
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="layout-grid" class="lucide-lg"></i>Overview</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="trending-up" class="lucide-lg"></i>Reports</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="package" class="lucide-lg"></i>Images</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium bg-white/16 text-white">
                    <i data-lucide="settings" class="lucide-lg"></i>Custom Packages</a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <i data-lucide="package-2" class="lucide-lg"></i>Helm charts</a></li>
            </ul>

            <div class="absolute bottom-6 left-6 right-6 border-t border-gray-700 pt-4">
                <ul class="space-y-1">
                    <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                        <i data-lucide="settings" class="lucide-lg"></i>Settings</a></li>
                    <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                        <i data-lucide="info" class="lucide-lg"></i>Docs & support</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-white mb-2" style="font-size: 24px; letter-spacing: -0.72px;">Custom Packages</h1>
                <p class="text-white text-base">
                    Create and manage certificate packages for your container images.
                    <span class="text-chainguard-teal cursor-pointer hover:underline">Learn more</span>
                </p>
            </div>

            <div class="flex items-center justify-between mb-6">
                <div class="relative w-96">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="lucide text-gray-400"></i>
                    </div>
                    <input type="text" placeholder="Filter..." class="w-full pl-10 pr-4 py-2 bg-chainguard-dark border border-gray-600 rounded text-white placeholder-gray-400 focus:border-chainguard-teal focus:outline-none text-sm">
                </div>
                <button id="createPackageBtn" class="border border-chainguard-teal text-white px-6 py-2 rounded-full text-sm font-semibold hover:bg-chainguard-teal hover:text-black transition-colors">
                    Create New Custom Package
                </button>
            </div>

            <!-- Existing Packages Table -->
            <div class="bg-chainguard-darker/50 rounded-lg border border-gray-700 overflow-hidden">
                <div class="border-b border-gray-700 px-2 py-3">
                    <div class="grid grid-cols-5 gap-4 text-sm font-semibold text-white px-2">
                        <div class="text-left" style="width: 238px;">Package name</div>
                        <div class="text-left" style="width: 209px;">Common name</div>
                        <div class="text-left" style="width: 159px;">Issuer</div>
                        <div class="text-left" style="width: 132px;">Expires on</div>
                        <div class="text-right" style="width: 98px;">Updated</div>
                    </div>
                </div>

                <div class="divide-y divide-gray-700" id="packagesTable">
                    <!-- Individual AWS Certificates -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="aws-ec2-internal" onclick="viewCertificate('aws-ec2-internal')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">aws-ec2-internal-cert</div>
                                <div class="text-white" style="width: 209px;">*.ec2.internal CA</div>
                                <div class="text-white" style="width: 159px;">Amazon EC2 Root CA</div>
                                <div class="text-white" style="width: 132px;">Dec 15, 2026</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="aws-elb-cert" onclick="viewCertificate('aws-elb-cert')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">aws-elb-ssl-cert</div>
                                <div class="text-white" style="width: 209px;">*.elb.amazonaws.com</div>
                                <div class="text-white" style="width: 159px;">AWS Load Balancer CA</div>
                                <div class="text-white" style="width: 132px;">Aug 22, 2027</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 day ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="aws-cloudfront" onclick="viewCertificate('aws-cloudfront')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">aws-cloudfront-ssl</div>
                                <div class="text-white" style="width: 209px;">*.cloudfront.net</div>
                                <div class="text-white" style="width: 159px;">CloudFront Distribution CA</div>
                                <div class="text-white" style="width: 132px;">Mar 10, 2028</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">3 days ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Individual GCP Certificates -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="gcp-compute" onclick="viewCertificate('gcp-compute')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">gcp-compute-engine-cert</div>
                                <div class="text-white" style="width: 209px;">*.compute.googleapis.com</div>
                                <div class="text-white" style="width: 159px;">Google Compute CA</div>
                                <div class="text-white" style="width: 132px;">Nov 18, 2027</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">5 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="gcp-storage" onclick="viewCertificate('gcp-storage')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">gcp-cloud-storage-cert</div>
                                <div class="text-white" style="width: 209px;">*.storage.googleapis.com</div>
                                <div class="text-white" style="width: 159px;">Google Cloud Storage CA</div>
                                <div class="text-white" style="width: 132px;">Sep 5, 2027</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">12 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Individual Azure Certificates -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="azure-webapp" onclick="viewCertificate('azure-webapp')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">azure-webapp-ssl</div>
                                <div class="text-white" style="width: 209px;">*.azurewebsites.net</div>
                                <div class="text-white" style="width: 159px;">Microsoft Azure CA</div>
                                <div class="text-white" style="width: 132px;">Jun 12, 2026</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">6 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="azure-keyvault" onclick="viewCertificate('azure-keyvault')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">azure-keyvault-cert</div>
                                <div class="text-white" style="width: 209px;">*.vault.azure.net</div>
                                <div class="text-white" style="width: 159px;">Azure Key Vault CA</div>
                                <div class="text-white" style="width: 132px;">Apr 8, 2028</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">8 hours ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- DoD Certificate -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="individual" data-cert-id="dod-pki" onclick="viewCertificate('dod-pki')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">dod-enterprise-pki</div>
                                <div class="text-white" style="width: 209px;">*.dod.mil</div>
                                <div class="text-white" style="width: 159px;">DoD Root CA 6</div>
                                <div class="text-white" style="width: 132px;">Jan 24, 2053</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 day ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Uploaded Certificate -->
                    <div class="certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer" data-cert-type="custom" data-cert-id="internal-ca" onclick="viewCertificate('internal-ca')">
                        <div class="px-2 py-2">
                            <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                <div class="text-chainguard-teal font-medium" style="width: 238px;">internal-ca-bundle</div>
                                <div class="text-white" style="width: 209px;">*.internal.company.com</div>
                                <div class="text-white" style="width: 159px;">Internal Root CA</div>
                                <div class="text-white" style="width: 132px;">Oct 15, 2025</div>
                                <div class="text-chainguard-text-secondary text-right" style="width: 98px;">3 days ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- AWS Expandable Bundle -->
                    <div class="expandable-bundle">
                        <div class="hover:bg-gray-800/30 transition-colors cursor-pointer" onclick="toggleBundle(this)">
                            <div class="px-2 py-2">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="chevron-right" class="lucide text-white transition-transform bundle-arrow"></i>
                                        <i data-lucide="folder" class="lucide text-chainguard-teal"></i>
                                        <span class="text-chainguard-teal font-medium cursor-pointer" onclick="event.stopPropagation(); viewCertificate('aws-services-bundle');">aws-services-bundle (3)</span>
                                    </div>
                                    <div class="text-chainguard-text-secondary text-sm">1 week ago</div>
                                </div>
                            </div>
                        </div>
                        <div class="bundle-content hidden pl-8 bg-gray-800/20">
                            <div class="divide-y divide-gray-700/50">
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('aws-bundle-cert-1')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.s3.amazonaws.com</div>
                                        <div class="text-white" style="width: 159px;">AWS S3 Service CA</div>
                                        <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                    </div>
                                </div>
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('aws-bundle-cert-2')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.rds.amazonaws.com</div>
                                        <div class="text-white" style="width: 159px;">AWS RDS Service CA</div>
                                        <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                    </div>
                                </div>
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('aws-bundle-cert-3')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.lambda.amazonaws.com</div>
                                        <div class="text-white" style="width: 159px;">AWS Lambda Service CA</div>
                                        <div class="text-white" style="width: 132px;">Dec 31, 2027</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">1 week ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GCP Expandable Bundle -->
                    <div class="expandable-bundle">
                        <div class="hover:bg-gray-800/30 transition-colors cursor-pointer" onclick="toggleBundle(this)">
                            <div class="px-2 py-2">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="chevron-right" class="lucide text-white transition-transform bundle-arrow"></i>
                                        <i data-lucide="folder" class="lucide text-chainguard-teal"></i>
                                        <span class="text-chainguard-teal font-medium cursor-pointer" onclick="event.stopPropagation(); viewCertificate('gcp-platform-bundle');">gcp-platform-bundle (2)</span>
                                    </div>
                                    <div class="text-chainguard-text-secondary text-sm">2 weeks ago</div>
                                </div>
                            </div>
                        </div>
                        <div class="bundle-content hidden pl-8 bg-gray-800/20">
                            <div class="divide-y divide-gray-700/50">
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('gcp-bundle-cert-1')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.googleapis.com</div>
                                        <div class="text-white" style="width: 159px;">Google APIs CA</div>
                                        <div class="text-white" style="width: 132px;">Jan 20, 2029</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 weeks ago</div>
                                    </div>
                                </div>
                                <div class="certificate-row hover:bg-gray-700/30 transition-colors cursor-pointer px-2 py-2" onclick="viewCertificate('gcp-bundle-cert-2')">
                                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                                        <div class="text-gray-400 text-sm" style="width: 238px;">Certificate</div>
                                        <div class="text-white" style="width: 209px;">*.gcp.goog</div>
                                        <div class="text-white" style="width: 159px;">GCP Internal CA</div>
                                        <div class="text-white" style="width: 132px;">Jan 20, 2029</div>
                                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">2 weeks ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Side Panel -->
    <div id="panelOverlay" class="fixed inset-0 z-50 overflow-hidden hidden">
        <div class="absolute inset-0 bg-black/50" onclick="closePanel()"></div>
        <div class="absolute right-0 top-0 h-full w-[600px] shadow-xl" style="background-color: #14003D; border-left: 1px solid rgb(75 85 99);">
            <div class="flex flex-col h-full">
                <div class="flex items-center justify-between p-6 border-b border-gray-700">
                    <div>
                        <h2 class="text-xl font-bold text-white">Create Custom Package</h2>
                        <p class="text-sm text-gray-300 mt-1">Add certificate bundles to create a new custom package</p>
                    </div>
                    <button onclick="closePanel()" class="p-2 rounded-md hover:bg-white/10 text-gray-300 hover:text-white transition-colors">
                        <i data-lucide="x" class="lucide"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6">
                    <!-- Step 1: Selection -->
                    <div id="step-selection">
                        <h3 class="text-lg font-semibold text-white mb-4">Choose how to create your package</h3>
                        <div class="space-y-4">
                            <button onclick="showUpload()" class="w-full p-6 text-left rounded-lg border border-gray-600 hover:border-chainguard-teal hover:bg-chainguard-teal/5 transition-all group" style="background-color: rgba(17, 0, 51, 0.5);">
                                <h4 class="text-white font-medium mb-2 group-hover:text-chainguard-teal">Upload Certificate Bundle</h4>
                                <p class="text-sm text-gray-300">Create a custom package by uploading your own certificate files in PEM or PKCS#7 format</p>
                            </button>
                            <button onclick="showSuggestions()" class="w-full p-6 text-left rounded-lg border border-gray-600 hover:border-chainguard-teal hover:bg-chainguard-teal/5 transition-all group" style="background-color: rgba(17, 0, 51, 0.5);">
                                <h4 class="text-white font-medium mb-2 group-hover:text-chainguard-teal">Browse Chainguard Suggestions</h4>
                                <p class="text-sm text-gray-300">Create packages from popular, auto-updating certificate bundles managed by Chainguard</p>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Suggestions -->
                    <div id="step-suggestions" class="hidden">
                        <h3 class="text-lg font-semibold text-white mb-2">Chainguard Suggestions</h3>
                        <p class="text-sm text-gray-300 mb-6">Popular certificate bundles maintained by Chainguard.</p>

                        <div class="grid gap-3" id="certificateOptions">
                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="dod-eca" onclick="selectBundle('dod-eca', this)">
                                <h4 class="font-medium text-white text-sm mb-2">DoD PKCS#7 for ECA PKI Only</h4>
                                <p class="text-xs text-gray-400 mb-2">v5.12 • 12 certificates</p>
                                <p class="text-sm text-gray-300">US Department of Defense Enterprise Certificate Authority</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="dod-wcf" onclick="selectBundle('dod-wcf', this)">
                                <h4 class="font-medium text-white text-sm mb-2">DoD PKI CA Certificate Bundles: PKCS#7 for WCF B&I PKI</h4>
                                <p class="text-xs text-gray-400 mb-2">v5.17 • 8 certificates</p>
                                <p class="text-sm text-gray-300">DoD Web Communications Framework</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="icp-brazil" onclick="selectBundle('icp-brazil', this)">
                                <h4 class="font-medium text-white text-sm mb-2">PKI ICP Brazil</h4>
                                <p class="text-xs text-gray-400 mb-2">v2024.1 • 24 certificates</p>
                                <p class="text-sm text-gray-300">Brazilian Public Key Infrastructure</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="aws-pca" onclick="selectBundle('aws-pca', this)">
                                <h4 class="font-medium text-white text-sm mb-2">AWS Private CA Bundle</h4>
                                <p class="text-xs text-gray-400 mb-2">vLatest • 6 certificates</p>
                                <p class="text-sm text-gray-300">Amazon Web Services Private Certificate Authority</p>
                            </div>

                            <div class="certificate-option relative p-4 rounded-lg border border-gray-600 hover:border-gray-500 cursor-pointer transition-all" style="background-color: rgba(17, 0, 51, 0.5);" data-bundle-id="gcp-ca" onclick="selectBundle('gcp-ca', this)">
                                <h4 class="font-medium text-white text-sm mb-2">Google Cloud Certificate Authority Service</h4>
                                <p class="text-xs text-gray-400 mb-2">vLatest • 4 certificates</p>
                                <p class="text-sm text-gray-300">Google Cloud Platform managed certificate authorities</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2.5: Upload Certificate -->
                    <div id="step-upload" class="hidden">
                        <h3 class="text-lg font-semibold text-white mb-2">Upload Certificate</h3>
                        <p class="text-sm text-gray-300 mb-6">Upload your own certificate bundle in PEM or PKCS#7 format</p>

                        <div class="space-y-6">
                            <!-- Drag & Drop Area -->
                            <div id="upload-area" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-gray-500 transition-colors" style="background-color: rgba(17, 0, 51, 0.3);">
                                <input type="file" id="file-input" class="hidden" accept=".pem,.crt,.cer,.p7b,.p7c">
                                <i data-lucide="upload" class="lucide text-gray-400 mx-auto mb-4" style="width: 2rem; height: 2rem;"></i>
                                <h4 class="text-white font-medium mb-2">Drop certificate file here or click to browse</h4>
                                <p class="text-sm text-gray-300">Supports PEM, CRT, CER, PKCS#7 formats</p>
                            </div>

                            <!-- Certificate Preview -->
                            <div id="certificate-preview" class="hidden">
                                <h4 class="text-sm font-medium text-white mb-2">Certificate Content</h4>
                                <div class="bg-chainguard-darker border border-gray-600 rounded-lg overflow-hidden">
                                    <div class="relative">
                                        <div id="line-numbers" class="absolute left-2 top-2 text-xs text-gray-500 font-mono leading-5 text-right w-6 select-none"></div>
                                        <div id="certificate-content" class="pl-10 pr-4 py-2 text-xs font-mono text-gray-300 leading-5 max-h-48 overflow-y-auto"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Package Name -->
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-white">Package name</label>
                                <input id="upload-package-name" type="text" class="w-full px-3 py-2 bg-chainguard-dark border border-gray-600 rounded text-white placeholder-gray-400 focus:border-chainguard-teal focus:outline-none text-sm">
                                <p class="text-xs text-gray-400">Package name can only contain ASCII letters, digits, and the characters ., -, and _.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Package Configuration -->
                    <div id="step-details" class="hidden">
                        <h3 class="text-lg font-semibold text-white mb-2">Configure Package</h3>
                        <p class="text-sm text-gray-300 mb-6">Name your package and review the selected certificate bundle</p>

                        <div id="selected-bundle-info" class="bg-chainguard-darker/50 border border-gray-600 rounded-lg p-4 mb-6">
                            <!-- Bundle info will be populated here -->
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-white">Package name</label>
                            <input id="packageNameInput" type="text" class="w-full px-3 py-2 bg-chainguard-dark border border-gray-600 rounded text-white placeholder-gray-400 focus:border-chainguard-teal focus:outline-none text-sm">
                            <p class="text-xs text-gray-400">Package name can only contain ASCII letters, digits, and the characters ., -, and _.</p>
                        </div>
                    </div>
                </div>

                <div class="p-6 border-t border-gray-700">
                    <div class="flex justify-between">
                        <div class="flex gap-3">
                            <button id="backBtn" onclick="goBack()" class="hidden flex items-center gap-2 px-4 py-2 text-gray-300 hover:text-white transition-colors">
                                <i data-lucide="arrow-left" class="lucide"></i>Back
                            </button>
                        </div>
                        <div class="flex gap-3">
                            <button id="nextBtn" onclick="proceedNext()" class="hidden bg-chainguard-teal hover:bg-opacity-90 text-black px-6 py-2 rounded-md font-medium flex items-center gap-2 transition-colors">
                                Next <i data-lucide="arrow-right" class="lucide"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="fixed top-4 right-4 z-40 bg-green-500/20 border border-green-500/40 text-green-400 px-4 py-3 rounded-lg hidden">
        Custom package created successfully!
    </div>

    <!-- Delete Confirmation Dialog -->
    <div id="deleteDialog" class="fixed inset-0 z-60 overflow-hidden hidden">
        <div class="absolute inset-0 bg-black/50"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-chainguard-dark border border-gray-700 rounded-lg p-6 w-96">
            <h3 class="text-lg font-semibold text-white mb-4">Delete Certificate Package</h3>
            <p class="text-gray-300 mb-6">Are you sure you want to delete <span id="delete-cert-name" class="text-chainguard-teal font-medium"></span>? This action cannot be undone.</p>
            <div class="flex gap-3 justify-end">
                <button onclick="cancelDelete()" class="px-4 py-2 text-gray-300 hover:text-white transition-colors">Cancel</button>
                <button onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition-colors">Delete</button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let selectedBundle = null;
        let currentStep = 'selection';
        let uploadedFile = null;
        let uploadedFileContent = null;
        let currentViewingCert = null;
        let certificateToDelete = null;
        let isEditMode = false;

        // Certificate database
        const certificateData = {
            'aws-ec2-internal': {
                type: 'individual',
                packageName: 'aws-ec2-internal-cert',
                commonName: '*.ec2.internal CA',
                issuer: 'Amazon EC2 Root CA',
                expiryDate: 'Dec 15, 2026',
                lastUpdated: '2 hours ago',
                source: 'AWS Private CA',
                sourceUrl: 'https://docs.aws.amazon.com/privateca/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+XYfMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
BAYTAlVTMQswCQYDVQQIDAJXQTEQMA4GA1UEBwwHU2VhdHRsZTEPMA0GA1UECgwG
QW1hem9uMQswCQYDVQQLDAJFQzEPMA0GA1UEAwwGRUMyIENBMB4XDTI0MDExNTAw
MDAwMFoXDTI2MTIxNTAwMDAwMFowRTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAldB
MRAwDgYDVQQHDAdTZWF0dGxlMQ8wDQYDVQQKDAZBbWF6b24xCzAJBgNVBAsMAkVD
MQ8wDQYDVQQDDAZFQzIgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
AQC8qBu+0w51OkG8fw3ReHS/itcp9AEFC4ETwumtfwlS+tmxBU3ulJPATIHC/TCO
g6TksvijvwT8RJdmgOUQj1u/+PEo6C7tgBgM5t0RR3kYCFI2j1tRObJ4XVFELK
-----END CERTIFICATE-----`
            },
            'aws-elb-cert': {
                type: 'individual',
                packageName: 'aws-elb-ssl-cert',
                commonName: '*.elb.amazonaws.com',
                issuer: 'AWS Load Balancer CA',
                expiryDate: 'Aug 22, 2027',
                lastUpdated: '1 day ago',
                source: 'AWS Private CA',
                sourceUrl: 'https://docs.aws.amazon.com/privateca/',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAK8wE3z7+XYgMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
BAYTAlVTMQswCQYDVQQIDAJXQTEQMA4GA1UEBwwHU2VhdHRsZTEPMA0GA1UECgwG
QW1hem9uMQswCQYDVQQLDAJFTEIxDzANBgNVBAMMBkVMQiBDQTAeFw0yNDA4MjIA
-----END CERTIFICATE-----`
            },
            'internal-ca': {
                type: 'custom',
                packageName: 'internal-ca-bundle',
                commonName: '*.internal.company.com',
                issuer: 'Internal Root CA',
                expiryDate: 'Oct 15, 2025',
                lastUpdated: '3 days ago',
                source: 'Custom Upload',
                fileName: 'internal-ca.pem',
                certificateContent: `-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIJAL8zQ4z6+Custom0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
BAYTAlVTMRAwDgYDVQQHDAdDb21wYW55MRUwEwYDVQQKDAxJbnRlcm5hbCBPcmcx
FTATBgNVBAsMDElUIERlcGFydG1lbnQxGDAWBgNVBAMMD0ludGVybmFsIFJvb3Qg
Q0EwHhcNMjQxMDE1MDAwMDAwWhcNMjUxMDE1MDAwMDAwWjBFMQswCQYDVQQGEwJV
UzEQMA4GA1UEBwwHQ29tcGFueTEVMBMGA1UECgwMSW50ZXJuYWwgT3JnMRUwEwYD
VQQLDAxJVCBEZXBhcnRtZW50MRgwFgYDVQQDDA9JbnRlcm5hbCBSb290IENBMIIB
IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2l8zJ4fQ7ZxKl5UW8vR1mHxQ
-----END CERTIFICATE-----`
            }
        };

        function openPanel() {
            console.log('Opening panel...');
            document.getElementById('panelOverlay').classList.remove('hidden');
        }

        function closePanel() {
            console.log('Closing panel...');
            document.getElementById('panelOverlay').classList.add('hidden');
            resetToSelection();
        }

        function showUpload() {
            console.log('Showing upload...');
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-upload').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            currentStep = 'upload';
        }

        function showSuggestions() {
            console.log('Showing suggestions...');
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-suggestions').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            currentStep = 'suggestions';
        }

        function selectBundle(bundleId, element) {
            console.log('Selected bundle:', bundleId);
            selectedBundle = bundleId;

            // Reset all options
            document.querySelectorAll('.certificate-option').forEach(opt => {
                opt.classList.remove('border-chainguard-teal', 'bg-chainguard-teal/5');
                opt.classList.add('border-gray-600');
            });

            // Select this option
            element.classList.remove('border-gray-600');
            element.classList.add('border-chainguard-teal', 'bg-chainguard-teal/5');

            // Show next button
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function proceedNext() {
            console.log('Proceeding to next step, current:', currentStep, 'selected:', selectedBundle);

            if (currentStep === 'suggestions' && selectedBundle) {
                // Show package configuration
                document.getElementById('step-suggestions').classList.add('hidden');
                document.getElementById('step-details').classList.remove('hidden');
                document.getElementById('nextBtn').innerHTML = 'Create Package <i data-lucide="arrow-right" class="lucide"></i>';
                lucide.createIcons();
                currentStep = 'details';

                // Set package name and bundle info
                const packageNameInput = document.getElementById('packageNameInput');
                const bundleInfo = document.getElementById('selected-bundle-info');

                if (selectedBundle === 'aws-pca') {
                    console.log('Showing AWS bundle info');
                    packageNameInput.value = 'aws-private-ca-package';
                    bundleInfo.innerHTML = `
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 p-2 rounded-lg bg-white/5">
                                <i data-lucide="cloud" class="lucide text-orange-400" style="width: 1.5rem; height: 1.5rem;"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-white mb-2">AWS Private CA Bundle</h4>
                                <p class="text-sm text-gray-300 mb-3">Amazon Web Services Private Certificate Authority trusted roots</p>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-400">Version:</span><div class="text-white font-mono">Latest</div></div>
                                    <div><span class="text-gray-400">Certificates:</span><div class="text-white">6</div></div>
                                    <div><span class="text-gray-400">Provider:</span><div class="text-white">Amazon Web Services</div></div>
                                    <div><span class="text-gray-400">Last Updated:</span><div class="text-white">Sep 10, 2024</div></div>
                                </div>
                                <div class="mt-4 p-3 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                    <p class="text-sm text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (selectedBundle === 'gcp-ca') {
                    console.log('Showing GCP bundle info');
                    packageNameInput.value = 'gcp-ca-service-package';
                    bundleInfo.innerHTML = `
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 p-2 rounded-lg bg-white/5">
                                <i data-lucide="cloud" class="lucide text-purple-400" style="width: 1.5rem; height: 1.5rem;"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-white mb-2">Google Cloud Certificate Authority Service</h4>
                                <p class="text-sm text-gray-300 mb-3">Google Cloud Platform managed certificate authorities</p>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-400">Version:</span><div class="text-white font-mono">Latest</div></div>
                                    <div><span class="text-gray-400">Certificates:</span><div class="text-white">4</div></div>
                                    <div><span class="text-gray-400">Provider:</span><div class="text-white">Google Cloud</div></div>
                                    <div><span class="text-gray-400">Last Updated:</span><div class="text-white">Sep 5, 2024</div></div>
                                </div>
                                <div class="mt-4 p-3 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                    <p class="text-sm text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (selectedBundle === 'dod-eca') {
                    console.log('Showing DoD ECA bundle info');
                    packageNameInput.value = 'dod-eca-pki-package';
                    bundleInfo.innerHTML = `
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 p-2 rounded-lg bg-white/5">
                                <i data-lucide="building-2" class="lucide text-blue-400" style="width: 1.5rem; height: 1.5rem;"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-white mb-2">DoD PKCS#7 for ECA PKI Only</h4>
                                <p class="text-sm text-gray-300 mb-3">US Department of Defense Enterprise Certificate Authority</p>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-400">Version:</span><div class="text-white font-mono">5.12</div></div>
                                    <div><span class="text-gray-400">Certificates:</span><div class="text-white">12</div></div>
                                    <div><span class="text-gray-400">Provider:</span><div class="text-white">US Department of Defense</div></div>
                                    <div><span class="text-gray-400">Last Updated:</span><div class="text-white">Aug 15, 2024</div></div>
                                </div>
                                <div class="mt-4 p-3 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                    <p class="text-sm text-chainguard-teal">✓ Auto-updating certificate bundle</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                lucide.createIcons();
            } else if (currentStep === 'details') {
                // Create package
                const packageName = document.getElementById('packageNameInput').value;
                console.log('Creating package:', packageName);

                // Show notification
                document.getElementById('notification').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('notification').classList.add('hidden');
                }, 5000);

                // Add to table
                addPackageToTable(packageName, selectedBundle);
                closePanel();
            }
        }

        function goBack() {
            if (currentStep === 'details') {
                document.getElementById('step-details').classList.add('hidden');
                if (selectedBundle) {
                    document.getElementById('step-suggestions').classList.remove('hidden');
                    currentStep = 'suggestions';
                } else {
                    document.getElementById('step-upload').classList.remove('hidden');
                    currentStep = 'upload';
                }
                document.getElementById('nextBtn').innerHTML = 'Next <i data-lucide="arrow-right" class="lucide"></i>';
                lucide.createIcons();
            } else if (currentStep === 'suggestions' || currentStep === 'upload') {
                resetToSelection();
            }
        }

        function resetToSelection() {
            document.getElementById('step-details').classList.add('hidden');
            document.getElementById('step-suggestions').classList.add('hidden');
            document.getElementById('step-upload').classList.add('hidden');
            document.getElementById('step-selection').classList.remove('hidden');
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');

            // Reset header
            const header = document.querySelector('#panelOverlay h2');
            header.textContent = 'Create Custom Package';

            // Reset next button
            document.getElementById('nextBtn').innerHTML = 'Next <i data-lucide="arrow-right" class="lucide"></i>';
            document.getElementById('nextBtn').onclick = proceedNext;

            // Remove edit/delete buttons if they exist
            const cancelBtn = document.getElementById('cancelBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            if (cancelBtn) cancelBtn.remove();
            if (deleteBtn) deleteBtn.remove();

            // Reset package name input
            const packageNameInput = document.getElementById('packageNameInput');
            packageNameInput.disabled = false;
            packageNameInput.value = '';

            // Reset selections
            document.querySelectorAll('.certificate-option').forEach(opt => {
                opt.classList.remove('border-chainguard-teal', 'bg-chainguard-teal/5');
                opt.classList.add('border-gray-600');
            });

            selectedBundle = null;
            uploadedFile = null;
            uploadedFileContent = null;
            currentViewingCert = null;
            isEditMode = false;
            currentStep = 'selection';

            // Reset upload form
            document.getElementById('file-input').value = '';
            document.getElementById('certificate-preview').classList.add('hidden');
            document.getElementById('upload-package-name').value = '';
        }

        function addPackageToTable(packageName, bundleType) {
            const tableBody = document.getElementById('packagesTable');
            const newRow = document.createElement('div');
            newRow.className = 'hover:bg-gray-800/30 transition-colors cursor-pointer';

            let commonName, issuer, expiry;
            if (bundleType === 'aws-pca') {
                commonName = '*.amazonaws.com CA';
                issuer = 'Amazon Root CA';
                expiry = 'Dec 31, 2030';
            } else if (bundleType === 'gcp-ca') {
                commonName = '*.googleapis.com CA';
                issuer = 'Google Trust Services';
                expiry = 'Jan 15, 2029';
            } else if (bundleType === 'dod-eca') {
                commonName = '*.dod.mil CA';
                issuer = 'DoD Root CA';
                expiry = 'Jan 15, 2028';
            }

            newRow.innerHTML = `
                <div class="px-2 py-2">
                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                        <div class="text-chainguard-teal font-medium" style="width: 238px;">${packageName}</div>
                        <div class="text-white" style="width: 209px;">${commonName}</div>
                        <div class="text-white" style="width: 159px;">${issuer}</div>
                        <div class="text-white" style="width: 132px;">${expiry}</div>
                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">Just now</div>
                    </div>
                </div>
            `;
            tableBody.insertBefore(newRow, tableBody.firstChild);
        }

        function toggleBundle(element) {
            const bundleContent = element.parentElement.querySelector('.bundle-content');
            const arrow = element.querySelector('.bundle-arrow');

            if (bundleContent.classList.contains('hidden')) {
                bundleContent.classList.remove('hidden');
                arrow.style.transform = 'rotate(90deg)';
            } else {
                bundleContent.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // File upload functionality
        function initializeUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');

            // Drag & drop handlers
            uploadArea.addEventListener('dragenter', handleDragEnter);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => fileInput.click());

            // File input handler
            fileInput.addEventListener('change', handleFileSelect);
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('upload-area').classList.add('drag-active');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            if (!e.currentTarget.contains(e.relatedTarget)) {
                document.getElementById('upload-area').classList.remove('drag-active');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('upload-area').classList.remove('drag-active');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processUploadedFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                processUploadedFile(files[0]);
            }
        }

        function processUploadedFile(file) {
            // Validate file type
            const validExtensions = ['.pem', '.crt', '.cer', '.p7b', '.p7c'];
            const fileName = file.name.toLowerCase();
            const isValid = validExtensions.some(ext => fileName.endsWith(ext));

            if (!isValid) {
                alert('Please upload a valid certificate file (PEM, CRT, CER, PKCS#7)');
                return;
            }

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size too large. Please upload a file smaller than 10MB.');
                return;
            }

            uploadedFile = file;

            // Read file content
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedFileContent = e.target.result;
                displayCertificatePreview(uploadedFileContent);

                // Auto-generate package name
                const baseName = file.name.replace(/\.[^/.]+$/, '');
                document.getElementById('upload-package-name').value = `custom-cert-${baseName}`;

                // Show next button
                document.getElementById('nextBtn').classList.remove('hidden');
            };
            reader.readAsText(file);
        }

        function displayCertificatePreview(content) {
            const preview = document.getElementById('certificate-preview');
            const lineNumbers = document.getElementById('line-numbers');
            const contentDiv = document.getElementById('certificate-content');

            // Show preview
            preview.classList.remove('hidden');

            // Generate line numbers
            const lines = content.split('\n');
            lineNumbers.innerHTML = lines.map((_, i) => `<div>${i + 1}</div>`).join('');

            // Display content
            contentDiv.innerHTML = lines.map(line => `<div>${line}</div>`).join('');
        }

        // Update proceedNext to handle upload flow
        const originalProceedNext = proceedNext;

        function proceedNext() {
            if (currentStep === 'upload' && uploadedFile) {
                // Show package configuration for uploaded file
                document.getElementById('step-upload').classList.add('hidden');
                document.getElementById('step-details').classList.remove('hidden');
                document.getElementById('nextBtn').innerHTML = 'Create Package <i data-lucide="arrow-right" class="lucide"></i>';
                lucide.createIcons();
                currentStep = 'details';

                // Set package name and bundle info for uploaded file
                const packageNameInput = document.getElementById('packageNameInput');
                const bundleInfo = document.getElementById('selected-bundle-info');

                packageNameInput.value = document.getElementById('upload-package-name').value;
                bundleInfo.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 p-2 rounded-lg bg-white/5">
                            <i data-lucide="file-text" class="lucide text-chainguard-teal" style="width: 1.5rem; height: 1.5rem;"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-white mb-2">Uploaded Certificate</h4>
                            <p class="text-sm text-gray-300 mb-3">Custom certificate bundle uploaded from file</p>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><span class="text-gray-400">File:</span><div class="text-white">${uploadedFile.name}</div></div>
                                <div><span class="text-gray-400">Size:</span><div class="text-white">${(uploadedFile.size / 1024).toFixed(1)} KB</div></div>
                                <div><span class="text-gray-400">Type:</span><div class="text-white">Custom Upload</div></div>
                                <div><span class="text-gray-400">Format:</span><div class="text-white">${uploadedFile.name.split('.').pop().toUpperCase()}</div></div>
                            </div>
                            <div class="mt-4 p-3 rounded bg-yellow-500/10 border border-yellow-500/20">
                                <p class="text-sm text-yellow-400">⚠️ This is a custom upload. You'll need to manually update this package when certificates change.</p>
                            </div>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            } else {
                originalProceedNext();
            }
        }

        // View/Edit/Delete functionality
        function viewCertificate(certId) {
            console.log('Viewing certificate:', certId);
            currentViewingCert = certId;
            isEditMode = false;

            const cert = certificateData[certId];
            if (!cert) {
                console.error('Certificate not found:', certId);
                return;
            }

            // Open panel and set to view mode
            document.getElementById('panelOverlay').classList.remove('hidden');

            // Hide all steps
            document.getElementById('step-selection').classList.add('hidden');
            document.getElementById('step-suggestions').classList.add('hidden');
            document.getElementById('step-upload').classList.add('hidden');
            document.getElementById('step-details').classList.remove('hidden');

            // Update header for view mode
            const header = document.querySelector('#panelOverlay h2');
            header.textContent = 'View Certificate Package';

            // Populate certificate information
            const packageNameInput = document.getElementById('packageNameInput');
            const bundleInfo = document.getElementById('selected-bundle-info');

            packageNameInput.value = cert.packageName;
            packageNameInput.disabled = true; // Start in view mode

            // Create view content based on certificate type
            bundleInfo.innerHTML = createCertificateViewContent(cert);

            // Update footer buttons for view mode
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('nextBtn').innerHTML = 'Edit Package <i data-lucide="edit" class="lucide"></i>';
            document.getElementById('nextBtn').classList.remove('hidden');
            document.getElementById('nextBtn').onclick = () => editCertificate(certId);

            // Add delete button
            if (!document.getElementById('deleteBtn')) {
                const deleteBtn = document.createElement('button');
                deleteBtn.id = 'deleteBtn';
                deleteBtn.onclick = () => showDeleteDialog(certId);
                deleteBtn.className = 'bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium flex items-center gap-2 transition-colors';
                deleteBtn.innerHTML = '<i data-lucide="trash-2" class="lucide"></i>Delete';
                document.querySelector('#panelOverlay .p-6.border-t .flex.gap-3').appendChild(deleteBtn);
            }

            lucide.createIcons();
            currentStep = 'view';
        }

        function createCertificateViewContent(cert) {
            const iconType = cert.type === 'custom' ? 'file-text' : (cert.source.includes('AWS') ? 'cloud' : cert.source.includes('Google') ? 'cloud' : cert.source.includes('DoD') ? 'building-2' : 'shield');
            const iconColor = cert.type === 'custom' ? 'chainguard-teal' : (cert.source.includes('AWS') ? 'orange-400' : cert.source.includes('Google') ? 'purple-400' : 'blue-400');

            return `
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 p-2 rounded-lg bg-white/5">
                        <i data-lucide="${iconType}" class="lucide text-${iconColor}" style="width: 1.5rem; height: 1.5rem;"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-white mb-2">${cert.packageName}</h4>
                        <p class="text-sm text-gray-300 mb-3">${cert.type === 'custom' ? 'Custom uploaded certificate' : cert.source + ' managed certificate'}</p>

                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="text-gray-400">Common Name:</span><div class="text-white">${cert.commonName}</div></div>
                            <div><span class="text-gray-400">Issuer:</span><div class="text-white">${cert.issuer}</div></div>
                            <div><span class="text-gray-400">Expires:</span><div class="text-white">${cert.expiryDate}</div></div>
                            <div><span class="text-gray-400">Last Updated:</span><div class="text-white">${cert.lastUpdated}</div></div>
                        </div>

                        ${cert.type === 'custom' ?
                            `<div class="mt-4 p-3 rounded bg-yellow-500/10 border border-yellow-500/20">
                                <p class="text-sm text-yellow-400">⚠️ Custom upload - manual updates required</p>
                            </div>` :
                            `<div class="mt-4 p-3 rounded bg-chainguard-teal/10 border border-chainguard-teal/20">
                                <p class="text-sm text-chainguard-teal">✓ Auto-updating managed certificate</p>
                            </div>`
                        }

                        <div class="mt-4">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="text-sm font-medium text-white">Certificate Content</h5>
                                ${cert.sourceUrl ? `<a href="${cert.sourceUrl}" target="_blank" class="text-xs text-chainguard-teal hover:underline">Source: ${cert.source}</a>` : `<span class="text-xs text-gray-400">${cert.source}</span>`}
                            </div>
                            <div class="bg-chainguard-darker border border-gray-600 rounded-lg overflow-hidden">
                                <div class="relative">
                                    <div class="absolute left-2 top-2 text-xs text-gray-500 font-mono leading-5 text-right w-6 select-none">
                                        ${cert.certificateContent.split('\n').map((_, i) => `<div>${i + 1}</div>`).join('')}
                                    </div>
                                    <div class="pl-10 pr-4 py-2 text-xs font-mono text-gray-300 leading-5 max-h-48 overflow-y-auto">
                                        ${cert.certificateContent.split('\n').map(line => `<div>${line}</div>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function editCertificate(certId) {
            console.log('Editing certificate:', certId);
            isEditMode = true;

            // Update header
            const header = document.querySelector('#panelOverlay h2');
            header.textContent = 'Edit Certificate Package';

            // Enable package name editing
            const packageNameInput = document.getElementById('packageNameInput');
            packageNameInput.disabled = false;
            packageNameInput.focus();

            // Update footer buttons for edit mode
            document.getElementById('nextBtn').innerHTML = 'Save Changes <i data-lucide="save" class="lucide"></i>';
            document.getElementById('nextBtn').onclick = () => saveCertificateChanges(certId);

            // Add cancel button
            if (!document.getElementById('cancelBtn')) {
                const cancelBtn = document.createElement('button');
                cancelBtn.id = 'cancelBtn';
                cancelBtn.onclick = () => viewCertificate(certId); // Return to view mode
                cancelBtn.className = 'px-4 py-2 text-gray-300 hover:text-white transition-colors';
                cancelBtn.innerHTML = 'Cancel';
                document.querySelector('#panelOverlay .p-6.border-t .flex').insertBefore(cancelBtn, document.getElementById('nextBtn'));
            }

            lucide.createIcons();
            currentStep = 'edit';
        }

        function saveCertificateChanges(certId) {
            console.log('Saving changes for certificate:', certId);

            const newPackageName = document.getElementById('packageNameInput').value.trim();

            // Validate package name
            if (!newPackageName) {
                alert('Package name is required');
                return;
            }

            // Update certificate data
            if (certificateData[certId]) {
                certificateData[certId].packageName = newPackageName;
                certificateData[certId].lastUpdated = 'Just now';
            }

            // Update table row
            const tableRow = document.querySelector(`[data-cert-id="${certId}"]`);
            if (tableRow) {
                const nameCell = tableRow.querySelector('.text-chainguard-teal');
                nameCell.textContent = newPackageName;
                const updatedCell = tableRow.querySelector('.text-right');
                updatedCell.textContent = 'Just now';
            }

            // Show success notification
            showNotification('Certificate package updated successfully!', 'success');

            // Return to view mode
            viewCertificate(certId);
        }

        function showDeleteDialog(certId) {
            console.log('Showing delete dialog for:', certId);
            certificateToDelete = certId;

            const cert = certificateData[certId];
            document.getElementById('delete-cert-name').textContent = cert.packageName;
            document.getElementById('deleteDialog').classList.remove('hidden');
        }

        function cancelDelete() {
            console.log('Cancelling delete');
            document.getElementById('deleteDialog').classList.add('hidden');
            certificateToDelete = null;
        }

        function confirmDelete() {
            console.log('Confirming delete for:', certificateToDelete);

            if (certificateToDelete) {
                // Remove from data
                delete certificateData[certificateToDelete];

                // Remove from table
                const tableRow = document.querySelector(`[data-cert-id="${certificateToDelete}"]`);
                if (tableRow) {
                    // Handle bundle deletion
                    if (tableRow.closest('.expandable-bundle')) {
                        tableRow.closest('.expandable-bundle').remove();
                    } else {
                        tableRow.remove();
                    }
                }

                // Close dialogs
                document.getElementById('deleteDialog').classList.add('hidden');
                document.getElementById('panelOverlay').classList.add('hidden');

                // Show success notification
                showNotification('Certificate package deleted successfully!', 'success');

                // Reset state
                certificateToDelete = null;
                currentViewingCert = null;
                resetToSelection();
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `fixed top-4 right-4 z-40 px-4 py-3 rounded-lg ${
                type === 'success' ? 'bg-green-500/20 border border-green-500/40 text-green-400' :
                type === 'error' ? 'bg-red-500/20 border border-red-500/40 text-red-400' :
                'bg-blue-500/20 border border-blue-500/40 text-blue-400'
            }`;
            notification.classList.remove('hidden');

            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }

        // Update addPackageToTable to include certificate data
        function addPackageToTable(packageName, bundleType) {
            const tableBody = document.getElementById('packagesTable');
            const newRow = document.createElement('div');
            newRow.className = 'certificate-row hover:bg-gray-800/30 transition-colors cursor-pointer';

            let commonName, issuer, expiry, certId;
            if (bundleType === 'aws-pca') {
                commonName = '*.amazonaws.com CA';
                issuer = 'Amazon Root CA';
                expiry = 'Dec 31, 2030';
                certId = 'new-aws-' + Date.now();
            } else if (bundleType === 'gcp-ca') {
                commonName = '*.googleapis.com CA';
                issuer = 'Google Trust Services';
                expiry = 'Jan 15, 2029';
                certId = 'new-gcp-' + Date.now();
            } else if (bundleType === 'dod-eca') {
                commonName = '*.dod.mil CA';
                issuer = 'DoD Root CA';
                expiry = 'Jan 15, 2028';
                certId = 'new-dod-' + Date.now();
            } else {
                // Custom upload
                commonName = uploadedFile ? `*.${uploadedFile.name.split('.')[0]}.local` : '*.custom.local';
                issuer = 'Custom Root CA';
                expiry = 'Dec 31, 2025';
                certId = 'custom-' + Date.now();
            }

            // Add to certificate database
            certificateData[certId] = {
                type: bundleType ? 'curated' : 'custom',
                packageName: packageName,
                commonName: commonName,
                issuer: issuer,
                expiryDate: expiry,
                lastUpdated: 'Just now',
                source: bundleType ? (bundleType === 'aws-pca' ? 'AWS Private CA' : bundleType === 'gcp-ca' ? 'Google Cloud' : 'DoD PKI') : 'Custom Upload',
                sourceUrl: bundleType ? (bundleType === 'aws-pca' ? 'https://docs.aws.amazon.com/privateca/' : bundleType === 'gcp-ca' ? 'https://cloud.google.com/security/products/certificate-authority-service' : 'https://www.cyber.mil/pki-pke/tools-configuration-files/') : null,
                fileName: uploadedFile ? uploadedFile.name : null,
                certificateContent: uploadedFileContent || '-----BEGIN CERTIFICATE-----\n[Certificate content would be displayed here]\n-----END CERTIFICATE-----'
            };

            newRow.setAttribute('data-cert-type', certificateData[certId].type);
            newRow.setAttribute('data-cert-id', certId);
            newRow.onclick = () => viewCertificate(certId);

            newRow.innerHTML = `
                <div class="px-2 py-2">
                    <div class="grid grid-cols-5 gap-4 text-sm px-2">
                        <div class="text-chainguard-teal font-medium" style="width: 238px;">${packageName}</div>
                        <div class="text-white" style="width: 209px;">${commonName}</div>
                        <div class="text-white" style="width: 159px;">${issuer}</div>
                        <div class="text-white" style="width: 132px;">${expiry}</div>
                        <div class="text-chainguard-text-secondary text-right" style="width: 98px;">Just now</div>
                    </div>
                </div>
            `;
            tableBody.insertBefore(newRow, tableBody.firstChild);
        }

        // Initialize
        document.getElementById('createPackageBtn').addEventListener('click', openPanel);
        initializeUpload();
    </script>
</body>
</html>